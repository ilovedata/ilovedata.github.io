[["index.html", "생존분석 Preface", " 생존분석 서울시립대학교 통계학과 이용희 2021-05-14 Preface 이 책은 통게학과 대학원생들을 위한 교재이며 생존분석에 대한 이론과 응용에 대하여 다루고자 합니다. 이 책에 나오는 그림, 예제 등은 Moore (2016) 에서 발췌하여 사용하였습니다. 이 책에서 사용된 기호, 표기법, 프로그램의 규칙과 쓰임은 다음과 같습니다. 스칼라(scalar)와 일변량 확률변수는 일반적으로 보통 글씨체의 소문자로 표기한다. 특별한 이유가 있는 경우 대문자로 표시할 것이다. 벡터, 행렬, 다변량 확률벡터는 굵은 글씨체로 표기한다. 통계 프로그램은 R을 이용합니다. 이 책에서 사용되는 R 패키지는 다음과 같습니다. library(ggplot2) library(dplyr) library(tidyr) library(survival) library(asaur) library(date) "],["survivalintro.html", "제 1 장 생존함수와 위험함수 1.1 생존함수와 위험함수 1.2 위험함수의 형태 1.3 평균 생존시간과 중위 생존시간 1.4 임의중도절단 1.5 모수의 최대가능도 추정", " 제 1 장 생존함수와 위험함수 1.1 생존함수와 위험함수 확률변수 \\(T\\)를 생존시간이라고 하고 \\(f(t)\\)를 확률밀도함수라고 하자. \\(T\\)의 누적분포함수(cumulative distribution function; CDF)는 다음과 같이 정의된다. \\[ F(t) = P(T \\le t) = \\int_0^t f(t) dt \\] 또한 생존함수(Survival function)은 다음과 같이 정의된다. \\[ S(t) = P (T &gt; t) = 1-F(t) \\] 위험함수(hazrd function)의 정의는 다음과 같으며 만약 생존시간이 \\(t\\) 보다 클때 바로 사망할 확률을 의미하며 순간위험율(instantaneous failure rate)이다. \\[\\begin{align} h(t) &amp; = \\lim_{dt \\rightarrow 0} \\frac{ P(t &lt; T \\le t+ dt | T &gt; t) }{dt} \\\\ \\notag &amp; = \\lim_{dt \\rightarrow 0} \\frac{1}{dt} \\frac{P(P(t &lt; T \\le t+ dt )}{P(T &gt;t)} \\\\ \\notag &amp; = \\frac{f(t)}{S(t)} \\tag{1.1} \\end{align}\\] 위험함수의 의미를 좀더 자세히 알아보자. 위험함수는 아주 짧은 시간에 일아날 사건의 확률로서 순간적인(instantaneous)인 의미를 가진다. 정의에서 보듯이 아주 짧은 시간에 일어나는 극한(\\(lim_{dt \\rightarrow 0}\\))의 의미이다. 위험함수는 확률로서 정의되지만 발생율(rate)로 이해할 수 있다. 위험함수를 정의에서 분모는 확률이고 분자는 시간으로 표시되기 때문에 마차 단위 시간당 일어나는 발생율로 이해할 수 있다. 또한 위험함수의 값은 [0,1] 사이에 있는 것이 아니기 때문에 단위 시간당 발생율로 이해하는 것이 편리하다 (\\(h(t) \\ge 0\\)). 위험함수는 조건부 확률로 정의되어 있다. 즉, 모든 개체에 대한 사건이 아니라 시간 \\(t\\)까지 살아있는 개체들에 대한 위험율이다. 생존분석에서는 생존함수보다 위험함수가 더 큰 의미를 가진다. 위험함수가 시간에 따라서 변하는 추세는 시간에 따른 위험의 변화를 나타내기 때문에 생존함수보다 위험의 변화에 대한 정보를 잘 파악할 수 있다. 위험함수와 생존함수의 관계 생존함수와 위험함수는 다음과 같은 관계를 가지고 있다. \\[\\begin{align*} h(t) &amp; = \\frac{f(t)}{S(t)} \\\\ &amp; = \\frac{f(t)}{1-F(t)} \\\\ &amp; = - \\frac {\\partial}{\\partial t} \\log [1-F(t)] \\\\ &amp; = - \\frac {\\partial}{\\partial t} \\log S(t) \\end{align*}\\] 따라서 다음의 관계가 성립힌다. \\[ S(t) = exp[-H(t)] \\] 여기서 \\[ H(t) = \\int_0^t h(t) dt \\] 이며 \\(H(t)\\)를 누적 위험함수(cumulative hazard function)라고 한다. 위의 식에서 볼 수 있듯이 위험함수를 알면 생존함수를 쉽게 구할 수 있고 또한 반대로 생존함수를 알면 위험함수를 자동적으로 알게된다. 1.2 위험함수의 형태 앞에서 언급했듯이 위험함수는 시간에 따른 위험의 변화를 말해준다. 생존분석에서 중요한 분포들과 예제를 가지고 다양한 위험함수의 형태를 알아보자. 예제 1.1 (지수분포) 만약 생존시간 \\(T\\)가 지수분포(Exponential distribution)을 따른다고 하자. \\[ f(t; \\lambda) = \\lambda e^{-\\lambda t} \\] 위에서 \\(\\lambda\\) 는 흔히 단위시간 당 사망률, 실패율(failure rate)라고 부르며 \\(E(T) = 1/\\lambda\\)이다. 생존함수(survaival function)와 위험함수(hazard function)은 다음과 같이 주어진다. \\[\\begin{align*} S(t) &amp; = P(T&gt;t) = 1 - P(T \\le t) \\\\ &amp; = 1 - \\int_0^t \\lambda e^{-\\lambda t} \\\\ &amp; = 1 - (1-e^{-\\lambda t} ) \\\\ &amp; = e^{-\\lambda t} \\\\ h(t) &amp; = \\frac{f(t)}{S(t)} \\\\ &amp; = \\lambda e^{-\\lambda t} / e^{-\\lambda t} \\\\ &amp; = \\lambda \\end{align*}\\] 누적위험함수는 아래와 같다. \\[ H(t) = \\int_0^t h(t) dt = \\lambda t \\] 생존시간이 지수분포를 따른다면 위험함수는 시간에 관계없이 상수 \\(\\lambda\\)이다. 이렇게 시간에 따라서 위험함수가 상수인 경우는 현실에서는 거의 나타나지 않는다. 위험함수가 상수라는 것은 시간이 지나도 (1) 제품이 고정날 또는 (2) 사람이 사망할 위험성이 변허지 않는다는 의미이다. 지수분포는 생존분석에서 중요한 의미를 가진다. 즉, 생존시간이 지수분포를 따르면 개체는 얼마나 시간이 경과했는지 정보가 없다는 것이며 주어진 시각에 사건이 일어나지 않았다면 바로 다음 시간에 사건이 일어날 확률은 언제나 동일하다. \\(\\blacksquare\\) 예제 1.2 (와이블분포) 만약 생존시간이 와이블 분포(Weibull distribution)를 따른다면 확률밀도함수는 다음과 같다. \\[ f(t) = \\frac{\\lambda t^{\\lambda-1}}{\\theta^\\lambda} \\exp \\left[ - \\left(\\frac{t}{\\theta} \\right)^\\lambda \\right], \\quad \\theta,\\lambda&gt;0, t \\geq 0. \\] 평균은 \\(E(T)=\\theta \\Gamma(1+1/\\lambda)\\) 이다. 여기서 \\(\\lambda=1\\)이면 지수분포가 된다. 이때 생존 함수는 다음과 같다. \\[\\begin{eqnarray*} S(t) &amp;=&amp; 1-\\int_0^t \\frac{\\lambda t^{\\lambda-1}}{\\theta^\\lambda} \\exp \\left[ - \\left( \\frac{t}{\\theta} \\right)^\\lambda \\right] dt \\\\ &amp;=&amp; \\exp \\left[ - \\left( \\frac{t}{\\theta} \\right)^\\lambda \\right]. \\end{eqnarray*}\\] 또한 위험함수는 다음과 같다. \\[\\begin{eqnarray*} h(t) &amp;=&amp; \\frac{f(t)}{S(t)} \\\\ &amp;=&amp; \\frac{\\frac{\\lambda t^{\\lambda-1}}{\\theta^\\lambda} \\exp \\left[ - \\left( \\frac{t}{\\theta} \\right)^\\lambda \\right]}{\\exp \\left[ - \\left( \\frac{t}{\\theta} \\right)^\\lambda \\right]} \\\\ &amp;=&amp; \\left( \\frac{\\lambda }{\\theta^\\lambda} \\right) t^{\\lambda-1}. \\end{eqnarray*}\\] 위에서 볼 수 있듯이 \\(\\lambda=1\\)이면 지수분포가 되고 위험함수는 상수이다. 만약에 \\(\\lambda&gt;1\\)이면 위험함수는 시간에 따라 증가하며 \\(\\lambda&lt;1\\)이면 위험함수는 감소한다. 누적위험함수는 아래와 같다. \\[ H(t) = \\int_0^t h(t) dt = (t/\\theta)^\\lambda \\] 다음은 모수의 변화에 따른 와이블 분포의 위험함수이다. weibHaz &lt;- {function(x, shape, scale) dweibull(x, shape=shape, scale=scale)/pweibull(x, shape=shape, scale=scale, lower.tail=F)} curve(weibHaz(x, shape=1.5, scale=1/0.03), from=0, to=80, ylab=&#39;Hazard&#39;, xlab=&#39;Time&#39;, col=&quot;blue&quot;) curve(weibHaz(x, shape=1.0, scale=1/0.03), from=0, to=80, ylab=&#39;Hazard&#39;, xlab=&#39;Time&#39;, add=T, col=&quot;black&quot;) curve(weibHaz(x, shape=0.75, scale=1/0.03), from=0, to=80, ylab=&#39;Hazard&#39;, xlab=&#39;Time&#39;, add=T, col=&quot;red&quot;) text(45, 0.065, expression(lambda == 1.50), col=&quot;red&quot;, cex=1.3) text(58, 0.065, expression(theta==1/0.03), col=&quot;red&quot;, cex=1.3) text(45, 0.015, expression(lambda == 0.75), col=&quot;blue&quot;, cex=1.3) text(58, 0.015, expression(theta==1/0.03), col=&quot;blue&quot;, cex=1.3) text(45, 0.034, expression(lambda== 1.00), col=&quot;black&quot;, cex=1.3) text(58, 0.034, expression(theta==1/0.03), col=&quot;black&quot;, cex=1.3) \\(\\blacksquare\\) 예제 1.3 (미국 여자와 남자의 연령에 따른 사망위험율) 다음 그림은 미국 여자와 남자의 연령에 따른 사망위험율을 나타내는 위험함수를 보여주는 그림이다. Y 축은 로그 스케일로 그린 그림이며 2004년의 자료를 이용하여 그린 그림이다. 태어난 날과 그 후 몇 주동안은 매우 사망위험이 높다가 급격하게 떨어진다. 그리고 10대에서 약간의 증가 현상을 보이며 조금 감쏘하다가 시간이 지날수록 위험율이 완만하게 증가한다. 주목할 점은 남자가 여자보다 사망의 위험이 언제나 크다는 것이며 이는 잘 알려진 사실이다. tm &lt;- c(0, # birth 1/365, # first day of life 7/365, # seventh day of life 28/365, # fourth week of life 1:107) # subsequent years hazMale &lt;- as.numeric(survexp.us[,&quot;male&quot;,&quot;2004&quot;]) # 2004 males hazFemale &lt;- as.numeric(survexp.us[,&quot;female&quot;,&quot;2004&quot;]) # 2004 females tm.diff &lt;- diff(tm) survMale &lt;- exp(-cumsum(hazMale*tm.diff)*365.24) survFemale &lt;- exp(-cumsum(hazFemale*tm.diff)*365.24) # Figure 2.1.2 log hazard and survival for US males and females in 2004 par(mfrow=c(2,1), # two rows and one column of plots mar=c(4.2,5,2,2)) # set margins for the lower, left, top, and righ of each plot logHazMale &lt;- log(hazMale) logHazFemale &lt;- log(hazFemale) plot(logHazMale ~ tm[-1], type=&quot;l&quot;, xlab=&quot;Age in years&quot;, # x axis label ylab=&quot;Hazard&quot;,col=&quot;blue&quot;, # y azis label lwd=2, # double line width las=1, # make y axis labels perpendicular to axis axes=F, cex.lab=1.3, cex.axis=1.3) # make blue line solid lines(logHazFemale ~ tm[-1],type=&quot;l&quot;, col=&quot;red&quot;,lwd=2, lty=2) # add a red dashed line to the plot yyLabs &lt;- c(1e-07, 1e-06, 1e-05, 1e-04, 1e-03, 1e-02) yyLabsLog &lt;- log(yyLabs) axis(2, at=yyLabsLog, labels=c(expression(10^-7), expression(10^-6), expression(10^-5), expression(10^-4), expression(10^-3), expression(10^-2)), las=1) axis(1, cex.axis=1.3) legend(&quot;bottomright&quot;, legend=c(&quot;males&quot;,&quot;females&quot;), lty=c(1,2), col=c(&quot;blue&quot;,&quot;red&quot;), lwd=2, cex=1.3) title(&quot;Hazards for US males and females in 2004&quot;) tm.diff &lt;- diff(tm) # same length as &quot;tm&quot; survMale &lt;- exp(-cumsum(hazMale*tm.diff)*365.24) # survival probs for males survFemale &lt;- exp(-cumsum(hazFemale*tm.diff)*365.24) # survival probs for females #windows(width=7,height=5) plot(survMale ~ tm[-1],type=&quot;l&quot;, # lower case &quot;L&quot; indicates line plot xlab=&quot;Age in years&quot;, # x axis label ylab=&quot;Survival probability&quot;, # y azis label col=&quot;blue&quot;, # line color lwd=2, # double line width las=1, # make y axis labels perpendicular to axis ylim=c(0,1), cex.lab=1.3, cex.axis=1.3) # y axis limit ranges from 0 to 1 lines(survFemale ~ tm[-1], col=&quot;red&quot;, lwd=2, lty=2) # add a red dashed line to the plot legend(&quot;bottomleft&quot;, legend=c(&quot;males&quot;,&quot;females&quot;), lty=c(1,2), col=c(&quot;blue&quot;,&quot;red&quot;), lwd=2, cex=1.3) title(&quot;Survival of US males and females in 2004&quot;) \\(\\blacksquare\\) 1.3 평균 생존시간과 중위 생존시간 평균 생존시간 \\(\\mu\\) 다은과 같이 정의된다. \\[ \\mu = \\int_{0}^\\infty t f(t) dt \\] 잘 알려진 생존함수의 공식 \\(f(t) = dS(t)/dt\\)와 부분 적분 공식(integration by part)를 이용하면 평균 생존시간 \\(\\mu\\) 다은과 같이 구할 수 있다. \\[ \\mu = \\int_0^\\infty S(t)dt \\] 중위 생존시간은 \\(t_{med}\\) 다음 방정식을 만족하는 \\(t\\)의 값이다. \\[ t_{med} = \\inf ~ \\{t~|~ S(t) \\le 1/2 \\} \\] 1.4 임의중도절단 중도 절단 자료 생존시간 \\(T_1, T_2, \\dots, T_n\\)을 독립적으로 분포 \\(f_\\theta(t)\\)에서 추출하였다고 가정하고 중도절단시간 \\(C_1, C_2, \\dots, C_n\\)도 독립적으로 분포 \\(g(c)\\)에서 추출하였다고 가정하자. 생존시간 \\(T\\)와 중도절단시간 \\(C\\)가 서로 독립이라고 가정하며 이러한 가정을 임의 중도절단(random censoring)이라고 한다. 이제 관측한 생존시간 \\(X_i\\)는 다음과 같이 정의한다. \\[ X_i = \\min (T_i, C_i) \\quad i=1,2,\\dots, n \\] 또한 절단 표시변수 \\(\\delta_i\\)는 다음과 같이 정의한다. 표시변수 \\(\\delta_i\\) 가 1의 값을 가지면 실제 생존시간을 관측한 것이고 0이면 절단된 자료이다. \\[ \\delta_i = \\begin{cases} 1 &amp; T_i &lt; C_i \\\\ 0 &amp; T_i &gt; C_i \\end{cases} \\] 따라서 중도절단이 있는 자료는 다음과 같은 각 개체에 대한여 쌍으로 구성된 관측값이 얻어진다. \\[ (X_1, \\delta_1), (X_2, \\delta_2), \\dots, (X_n, \\delta_n) \\] 1.5 모수의 최대가능도 추정 이제 생존시간 \\(T\\)의 분포 \\(F_\\theta(t)\\) 가 주어졌을 때 표본 \\((x_i, \\delta_i)\\)의 가능도 함수 \\(L\\) 는 다음과 같이 나타낼 수 있다. \\[ L(\\theta; x, \\delta) = \\prod_{i \\in UC} P_\\theta(T_i= x_i ) \\prod_{i \\in C} P_\\theta(T_i &gt; x_i ) = \\prod_{i \\in UC} f_\\theta( x_i ) \\prod_{i \\in C} [1-F_\\theta( x_i )] \\] 여기서 집합 \\(UC\\)는 실제 생존시간이 관측된 자료들, 집합 \\(C\\)는 중도절단된 자료을 의미한다. 모수의 최대가능도 추정은 \\(L(\\theta; X, \\delta)\\)를 최대로 하는 \\(\\theta\\)를 찾는 방법이다. 이제 예제로서 생존시간의 분포가 지수분포를 따른다고 가정하고 가능도함수를 구해보자. \\[\\begin{align*} L(\\lambda; x, \\delta) &amp; = \\prod_{i \\in UC} P_\\lambda(T_i= x_i ) \\prod_{i \\in C} P_\\lambda(T_i &gt; x_i ) \\\\ &amp; = \\prod_{i \\in UC} f_\\lambda( x_i ) \\prod_{i \\in C} [1-F_\\lambda( x_i )] \\\\ &amp; = \\prod_{i=1}^n \\left [ \\lambda e^{-\\lambda x_i} \\right ]^{\\delta_i} \\left [e^{-\\lambda x_i} \\right ]^{1-\\delta_i} \\\\ &amp; = \\prod_{i=1}^n \\lambda^{\\delta_i} e^{-\\lambda x_i} \\\\ &amp; = \\lambda^{ \\sum_{i=1}^n \\delta_i} e^{-\\lambda \\sum_{i=1}^n x_i} \\end{align*}\\] 이제 위의 가능도함수를 최대화하는 모수를 찾기위하여 로그가능도함수를 고려하고 \\[ \\ell (\\lambda; x, \\delta) = \\log L(\\lambda; x, \\delta) = \\log \\lambda \\sum_{i=1}^n \\delta_i - \\lambda \\sum_{i=1}^n x_i \\] 로그가능도함수를 모수 \\(\\lambda\\)에 대하여 미분하고 0으로 놓고 풀면 최대가능도 추정량을 구할 수 있다. \\[ \\frac{\\partial}{\\partial \\lambda} \\ell (\\lambda; x, \\delta) = \\frac{\\sum_{i=1}^n \\delta_i}{\\lambda} - \\sum_{i=1}^n x_i = 0 \\] 따라서 최대가능도 추정량은 다음과 같이 주어진다. \\[ \\hat \\lambda_{ML} = \\frac{\\sum_{i=1}^n \\delta_i}{\\sum_{i=1}^n x_i} \\] 만약 중도절단자료가 없다면 최대가능도 추정량은 일반적인 경우와 같이 다음과 같다. \\[ \\hat \\lambda_{ML} = \\frac{n}{\\sum_{i=1}^n x_i} \\] "],["estsurvival.html", "제 2 장 생존함수의 추정 2.1 생명표방법을 이용한 생존함수 추정 2.2 누적한계추정법에 의한 생존함수 추정 2.3 Nelson-Aalen 추정량 2.4 중위 생존시간 2.5 확률 과정과 Nelson-Aalen 추정량 2.6 예제", " 제 2 장 생존함수의 추정 2.1 생명표방법을 이용한 생존함수 추정 시간 \\((0, \\infty)\\)구간을 다음과 같은 경계선을 이용하여 \\(k+1\\) 개의 구간으로 나누었다고 가정하자. (\\(t_0=0\\)) \\[ (t_0, t_1] \\quad (t_1,t_2] \\quad \\dots \\quad (t_{k-1}, t_k] \\quad (t_k, \\infty) \\] 생존함수는 다음과 같은 조건부 확률의 축차식으로 구할 수 있다. \\[\\begin{align*} S(t_i) &amp; = p(T&gt;t_i) \\\\ &amp; = P(T &gt; t_i | T &gt; t_{i-1}) P(T &gt; t_{i-1}) \\\\ &amp; = P(T &gt; t_i | T &gt; t_{i-1}) P(T &gt; t_{i-1} | T &gt; t_{i-2}) P(T &gt; t_{i-2} ) \\\\ &amp; = \\cdots \\\\ &amp; = P(T &gt; t_i | T &gt; t_{i-1}) P(T &gt; t_{i-1} | T &gt; t_{i-2}) P(T &gt; t_{i-2} ) \\dots P(T&gt; t_2 | T &gt; t_1)P(T &gt; t_1) \\end{align*}\\] 생명표방법을 이용한 생존함수 추정은 표를 이용하면 편리하다. 다음은 표를 생명표방법을 이용하여 생존함수를 추정하는 예를 보여준다. 구간 위험그룹인원수 사망자 수 중도절단 수 유효인원수 사망율 생존율 생존함수 추정 \\(I_i\\) \\(n_i\\) \\(d_i\\) \\(c_i\\) \\(n&#39;_i\\) \\(\\tfrac{d_i}{n&#39;_i}\\) \\(1-\\tfrac{d_i}{n&#39;_i}\\) \\(\\hat S(t_i)\\) 0-1 126 47 19 116.5 0.40 0.60 0.60 1-2 60 5 17 51.5 0.10 0.90 0.54 2-3 38 2 15 30.5 0.07 0.93 0.50 3-4 21 2 9 16.5 0.12 0.88 0.44 4-5 10 0 6 7.0 0.00 1.00 0.44 위에서 유효인원수는 다음과 같이 계산한다. \\[ n&#39;_i = n_i - \\frac{c_i}{2} \\] 또한 생존함수의 추정식은는 조건부 확률의 축차식을 이용하여 다음과 같이 계산한다. \\[ \\hat S(t_i) = \\prod_{k=1}^i \\hat p_k = \\prod_{k=1}^i \\left ( 1-\\tfrac{d_k}{n&#39;_k} \\right ) \\] 이와 같이 주정된 생존함수의 분산은 다음과 같은 그린우드의 공식으로 구할 수 있다. \\[ \\widehat {Var} (\\hat S (t_i) ) = \\hat S(t_i) \\sum_{k=1}^i \\frac{d_k}{ n_k^{&#39;} ( n_k^{&#39;} -d_k)} \\] 2.2 누적한계추정법에 의한 생존함수 추정 표본으로 추출한 생존시간들을 순서대로 \\(t_1 &lt; t_2 &lt; \\dots &lt; t_n\\) 나열한 다음 누적한계추정법은 생존함수를 다음의 식으로 추정한다. \\[ \\hat S(t) = \\prod_{t_i \\le t} \\left ( 1-\\frac{d_i}{n_i} \\right)^{\\delta_i} = \\prod_{t_i \\le t} \\left ( \\frac{n_i-d_k}{n_i} \\right)^{\\delta_i}\\] \\(n_i\\) : 시간 \\(t_i\\) 바로 직전까지 중도절단되지 않고 생존한 사람의 수 \\(d_i\\) : 시간 \\(t_i\\) 에 사망한 사람의 수 생존함수 추정량 \\(\\hat S(t)\\) 의 분산은 다음과 같이 주어진다. \\[ Var(\\hat S(t)) = [\\hat S(t)]^2 \\sum_{t_i \\le t} \\frac{d_i}{n_i(n_i-d_i)} \\] 위의 분산추정량으로 생존함수의 신뢰구간을 구하면 [0,1]의 범위를 벗어나는 경우가 생긴다. 이러한 단범을 보완하기 위하여 생존함수의 변환(log-log transformation)에 대한 신뢰구간을 구하는 방법을 주로 사용한다. \\[ Var\\left ( \\log \\left [ - \\log \\hat S(t) \\right ] \\right ) \\approx \\frac{1}{[\\hat S(t)]^2 } \\sum_{t_i \\le t} \\frac{d_i}{n_i(n_i-d_i)} \\] 예제 2.1 (누적한계추정법) 다음 주어진 자료로부터 생존함수를 추정하는 방법을 알아보자. \\(+\\)는 중도절단된 자료를 표시한다. \\[ 9,~~13,~~13+,~~18,~~23~~,28+,~~31,~~,34,~~,45+,~~,48,~~161+ \\] 누적한계추정법은 생존함수를 다음과 같이 축차적으로 구할 수 있다. \\[\\begin{align*} \\hat S(0) &amp; = 1 \\\\ \\hat S(9) &amp; = \\hat S(0) \\times \\frac{10}{11} = 0.91 \\\\ \\hat S(13) &amp; = \\hat S(9) \\times \\frac{9}{10} = 0.82 \\\\ \\hat S(18) &amp; = \\hat S(13) \\times \\frac{7}{8} = 0.72 \\\\ \\hat S(23) &amp; = \\hat S(18) \\times \\frac{6}{7} = 0.61 \\\\ \\hat S(31) &amp; = \\hat S(23) \\times \\frac{4}{5} = 0.49 \\\\ \\hat S(34) &amp; = \\hat S(31) \\times \\frac{3}{4} = 0.37 \\\\ \\hat S(48) &amp; = \\hat S(34) \\times \\frac{1}{2} = 0.18 \\end{align*}\\] \\(\\blacksquare\\) 다음은 예제 자료에 대하여 누적한계추정법으로 생존함수를 추정하는 R 프로그램이다. t &lt;- c(9, 13, 13, 18 ,23 ,28, 31, 34 ,45 ,48 ,161) cens &lt;- c(1,1,0,1,1,0,1,1,0,1,0) df &lt;- Surv(t, cens) df ## [1] 9 13 13+ 18 23 28+ 31 34 45+ 48 161+ res.km &lt;- survfit(Surv(t, cens)~1, conf.type=&quot;log-log&quot;) res.km ## Call: survfit(formula = Surv(t, cens) ~ 1, conf.type = &quot;log-log&quot;) ## ## n events median 0.95LCL 0.95UCL ## 11 7 31 13 NA summary(res.km) ## Call: survfit(formula = Surv(t, cens) ~ 1, conf.type = &quot;log-log&quot;) ## ## time n.risk n.event survival std.err lower 95% CI upper 95% CI ## 9 11 1 0.909 0.0867 0.5081 0.987 ## 13 10 1 0.818 0.1163 0.4474 0.951 ## 18 8 1 0.716 0.1397 0.3502 0.899 ## 23 7 1 0.614 0.1526 0.2658 0.835 ## 31 5 1 0.491 0.1642 0.1673 0.753 ## 34 4 1 0.368 0.1627 0.0928 0.657 ## 48 2 1 0.184 0.1535 0.0117 0.525 plot(res.km) 2.3 Nelson-Aalen 추정량 Nelson-Aalen 추정량은 생존함수와 위험함수의 관계를 이용하는 추정량이다. 누적 위험함수 \\(H(t)\\) 는 시간 \\(t\\)까지 위험함수의 합이므로 다음과 같이 추정할 수 있다. \\[ \\hat H(t) = \\sum_{t_i \\le t} \\frac{d_i}{n_i} \\] 따라서 생존함수과의 관계를 이용하면 Nelson-Aalen 추정량은 다음과 같이 주어진다. \\[ \\hat S(t) = e^{- \\hat H(t)} \\] 다음은 예제 자료에 대하여 Nelson-Aalen 추정량(type=\"fh\")으로 생존함수를 추정하는 R 프로그램이다. res.fh &lt;- survfit(Surv(t, cens)~1, conf.type=&quot;log-log&quot;, type=&quot;fh&quot;) res.fh ## Call: survfit(formula = Surv(t, cens) ~ 1, conf.type = &quot;log-log&quot;, type = &quot;fh&quot;) ## ## n events median 0.95LCL 0.95UCL ## 11 7 34 13 NA summary(res.fh) ## Call: survfit(formula = Surv(t, cens) ~ 1, conf.type = &quot;log-log&quot;, type = &quot;fh&quot;) ## ## time n.risk n.event survival std.err lower 95% CI upper 95% CI ## 9 11 1 0.913 0.083 0.5245 0.987 ## 13 10 1 0.826 0.112 0.4655 0.953 ## 18 8 1 0.729 0.134 0.3716 0.904 ## 23 7 1 0.632 0.147 0.2890 0.844 ## 31 5 1 0.517 0.159 0.1935 0.768 ## 34 4 1 0.403 0.160 0.1183 0.679 ## 48 2 1 0.244 0.156 0.0327 0.560 plot(res.fh) 2.4 중위 생존시간 중위 생존시간의 추정량은 \\(\\hat t_{med}\\) 다음 방정식을 만족하는 \\(t\\)의 값이다. \\[ \\hat t_{med} = \\inf ~ \\{t~|~ \\hat S(t) \\le 1/2 \\} \\] res.km ## Call: survfit(formula = Surv(t, cens) ~ 1, conf.type = &quot;log-log&quot;) ## ## n events median 0.95LCL 0.95UCL ## 11 7 31 13 NA 2.5 확률 과정과 Nelson-Aalen 추정량 이제 위험함수를 추정하는 Nelson-Aalen 추정량을 확률 과정으로 유도해보자. 먼저 생존시간 \\(T_i\\)에 대한 계수과정(counting process) \\(Y_i(t)\\) 을 정의해 보자. \\(Y_i(t)\\) 는 사건이 일어나기 전 까지 1인 함수이며 시간 \\(t\\) 까지 \\(i\\) 번째 개체가 위험 그룹(at risk at \\(t\\))에 속한는 지를 나타내는 확률과정이다. \\[ Y_i(t) = I(T_i \\ge t)\\] 또 하나의 계수과정 \\(N_i(t)\\)를 아래와 같이 정의한다. \\(N_i(t)\\) 는 절단이 없는 자 개체에 대하여 시간 \\(t\\) 까지 사건이 일어났는지를 알려주는 과정이다. \\[ N_i(t) = I(T_i \\le t, \\delta_i=1) \\] \\(Y_i(t)\\) 와 \\(N_i(t)\\)는 다음과 같은 모양을 가진 시간에 대한 함수이다. \\(Y_i(t)\\) 와 \\(N_i(t)\\) \\(Y_i(t)\\)는 왼쪽 연속함수(left continuity)의 형태를 가진다. 오른쪽 연속인 확률과정을 예측가능한 과정(predictable process) 라고 한다. \\(N_i(t)\\)는 오른쪽 연속함수(right continuity)의 형태를 가진다. 이제 두 확률 과정의 합을 정의하자. \\[ \\bar Y(t) =\\sum_{t_i \\le t} Y_i(t) \\quad \\text{ number at risk at } t\\] \\[ \\bar N(t) =\\sum_{t_i \\le t} N_i(t) \\quad \\text{ number of failures up to} t\\] 이제 누적 위험함수는 매우 짧은 시간 \\(h\\) 에 대하녀 다음과 같은 근사식이 성립한다. \\[ H(s+h) - H(s) \\approx h(s) h \\] 위의 식에서 \\(h(s)h\\) 는 시간 \\([s, s+h]\\) 동안에 일어난 사건의 발생률이라고 볼 수 있다. 따라서 \\(h(s)h\\) 는 시간 \\([s, s+h]\\) 동안에 일어난 사건의 발생한 사건의 수 \\(\\bar N(s+h) -\\bar N(s)\\)를 시간 \\(s\\) 에 위험해 처한 개채의 수 \\(\\bar Y(s)\\) 로 나는 값으로 추정할 수 있다. 이러한 사실을 이용하면 다음과 같은 추정식을 얻는다. \\[ \\hat H(t) = \\int_0^t \\frac{d \\bar N(s)} {\\bar Y(s)} \\] 위에서 구한 추정량 \\(\\hat H(t)\\) 는 각 사건이 일어날 경우만 점프가 생기므로 다음과 같이 쓸수 있다. \\[ \\hat H(t) =\\sum_{t_i \\le t} \\frac{\\Delta \\bar N(t_i)}{\\bar Y(ti)} = \\sum_{t_i \\le t} \\frac{d_i}{n_i}\\] plot(res.fh, cumhaz=TRUE) 2.6 예제 clinical trial of the chemotherapeutic agent Xelox administered to patients with advanced gastric cancer prior to surgery. The primary outcome of interest is “progression-free survival.” This quantity is defined as the time from entry into a clinical trial until progression or death, whichever comes first. timeMonths &lt;- gastricXelox$timeWeeks*7/30.25 result.km &lt;- survfit(Surv(timeMonths, delta) ~ 1, conf.type=&quot;log-log&quot;, data=gastricXelox) # median survival and 95% confidence interval is printed as follows: result.km ## Call: survfit(formula = Surv(timeMonths, delta) ~ 1, data = gastricXelox, ## conf.type = &quot;log-log&quot;) ## ## n events median 0.95LCL 0.95UCL ## 48.00 32.00 10.30 5.79 15.27 plot(result.km, mark=&quot;|&quot;, ylab=&quot;Survival probability&quot;, xlab=&quot;Time in months&quot;, cex.axis=1.5, cex.lab=1.5, lwd=1.5) plot(result.km, cumhaz=TRUE, mark=&quot;|&quot;, ylab=&quot;cumulative hazrd&quot;, xlab=&quot;Time in months&quot;, cex.axis=1.5, cex.lab=1.5, lwd=1.5) "],["logrank.html", "제 3 장 비모수적 방법을 이용한 생존함수의 비교 3.1 비모수적 방법을 이용한 생존함수의 비교 3.2 예제 3.3 일반화 로그 순위 검정", " 제 3 장 비모수적 방법을 이용한 생존함수의 비교 3.1 비모수적 방법을 이용한 생존함수의 비교 두 개의 독립 집단에 대하여 다음과 같이 생존시간을 관측하였다고 하자. \\[\\begin{align*} \\text{group 1} \\quad &amp; (X_{11}, \\delta_{11}), (X_{12}, \\delta_{12}) , \\dots ,(X_{1 n_1}, \\delta_{1 n_1}) \\\\ \\text{group 2} \\quad &amp; (X_{21}, \\delta_{21}), (X_{22}, \\delta_{22}) , \\dots ,(X_{2 n_2}, \\delta_{2 n_2}) \\\\ \\end{align*}\\] 두 개의 집단에 대한 생존함수가 동일하다는 다음 가설을 고려하자. \\[ H_0: S_1 = S_2 \\quad H_1: S_1 \\ne S_2 \\] 위의 가설은 두 집단의 생존시간을 모두 합쳐서 순서대로 나열하고 중도절단이 없는 자료들에서 다음과 같은 \\(2\\times 2\\) 분할표를 작성한 다음 CMH-검정 통계량을 이용하여 검정할 수 있다. 처리/반응여부 사망 생존 합계 1 \\(a\\) \\(b\\) \\(n_1\\) 2 \\(c\\) \\(d\\) \\(n_2\\) 합계 \\(m_1\\) \\(m_2\\) \\(n\\) 다음과 같은 예제 자료를 고려해보자 \\[\\begin{align*} \\text{[group 1]} \\quad &amp; 3,~~5,~~7,~~9+~~, 18 \\\\ \\text{[group 2]} \\quad &amp; 12,~~ 19,~~ 20,~~ 20+,~~ 33+ \\\\ \\end{align*}\\] 두 표본을 합쳐서 순서대로 놓으면 다음과 같다. \\[ 3,~~5,~~7,~~9+~~12,~~ 18, ~~ 19,~~ 20,~~ 20+,~~ 33+ \\] 이제 중도절단이 없는 자료들(\\(3,5,7,12,18,19,20\\))에 대하여 각각 \\(2\\times 2\\) 분할표를 작성하고 CMH-검정 통계량을 계산할 수 있다. 각 분할표와 관련 통계량을 다음과 같은 표로 정리할 수 있다. \\(X\\) \\(n\\) \\(m_1\\) \\(n_1\\) \\(a\\) \\(E_0(A)\\) \\(a-E_0(A)\\) \\(m_1 m_2/(n-1)\\) \\(n_1 n_2 /n^2\\) 3 10 1 5 1 0.50 0.50 1 0.2500 5 9 1 4 1 0.44 0.56 1 0.2469 7 8 1 3 1 0.38 0.62 1 0.2344 12 6 1 1 0 0.17 -0.17 1 0.1389 18 5 1 1 1 0.20 0.80 1 0.1600 19 4 1 0 0 0 0 1 0 20 3 1 0 0 0 0 1 0 이제 다음과 같이 CMH 통계량을 계산할 수 있다. \\[ CMH ~~\\chi^2 = \\frac {[ \\sum (a-E_0(A))]^2}{ \\sum [m_1 m_2/(n-1)][n_1 n_2 /n^2] } \\] 여기서 \\[\\begin{align*} \\sum (a-E_0(A)) &amp; = 0.50 + 0.56 + 0.62 -0.17 + 0.80 \\\\ &amp; = 2.31 \\\\ \\sum [m_1 m_2/(n-1)][n_1 n_2 /n^2] &amp; = (1)(0.2500) + (1)(0.2469) + (1)(0.2344) \\\\ &amp;+ (1)(0.1389) + (1)(0.1600) + (1)(0) + (1)(0) \\\\ &amp; = 1.0302 \\end{align*}\\] 따라서 \\[ CMH ~~\\chi^2 = \\frac{(2.31)^2} {1.0302} = 5.1796 \\] 유의수준 \\(\\alpha=0.05\\)에서 \\(\\chi^2(1,0.95) = 3.84159 &lt;5.1796\\)이므로 \\(H_0\\)를 기각한다. 즉 두 집단의 생존함수는 같지 않다. t &lt;- c(3, 5, 7, 9, 12, 18, 19, 20, 20, 33) delta &lt;- c(1,1,1,0,1,1,1,1,0,0) treat &lt;- c(&quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;B&quot;, &quot;A&quot;, &quot;B&quot;, &quot;B&quot;, &quot;B&quot;, &quot;B&quot;) df &lt;- data.frame(t, delta, treat) res.comp &lt;- survdiff(Surv(t, delta) ~ treat, data=df) 3.2 예제 The data set “pancreatic” in the “asaur” package consists of pancreatic cancer data from a Phase II clinical trial where the primary outcome of interest is progression-free survival. As we saw in the previous chapter, this quantity is defined as the time from entry into a clinical trial until progression or death, whichever comes first. The data consist of, for each patient, the stage, classified as “LAPC” (locally advanced pancreatic cancer) or “MPC” (metastatic pancreatic cancer), the date of entry into the clinical trial, the date of death (all of the patients in this study died), and the date of progression, if that was observed before death. The first six observations are shown in this output. head(pancreatic) ## stage onstudy progression death ## 1 M 12/16/2005 2/2/2006 10/19/2006 ## 2 M 1/6/2006 2/26/2006 4/19/2006 ## 3 LA 2/3/2006 8/2/2006 1/19/2007 ## 4 M 3/30/2006 . 5/11/2006 ## 5 LA 4/27/2006 3/11/2007 5/29/2007 ## 6 M 5/7/2006 6/25/2006 10/11/2006 attach(pancreatic) # make the variable names accessible # convert the text dates into R dates Progression.d &lt;- as.date(as.character(progression)) OnStudy.d &lt;- as.date(as.character(onstudy)) Death.d &lt;- as.date(as.character(death)) # compute progression-free survival progressionOnly &lt;- Progression.d - OnStudy.d overallSurvival &lt;- Death.d - OnStudy.d pfs &lt;- pmin(progressionOnly, overallSurvival) pfs[is.na(pfs)] &lt;- overallSurvival[is.na(pfs)] # convert pfs to months os &lt;- overallSurvival status &lt;- rep(1, length(pfs)) # Note: &quot;pancreatic2&quot; is already part of the &quot;asaur&quot; package; this is how one would create it: #pancreatic2 &lt;- data.frame(pfs, os, status, stage) # create &quot;pancreatic2&quot; data frame # library(pancreatic2) # an alternative to the above is to just use pancreatic2 pfs.month &lt;- pfs/30.5 plot(survfit(Surv(pfs.month) ~ stage), xlab=&quot;Time in months&quot;, ylab=&quot;Survival probability&quot;, col=c(&quot;blue&quot;, &quot;red&quot;), lwd=2) legend(&quot;topright&quot;, legend=c(&quot;Locally advanced&quot;, &quot;Metastatic&quot;), col=c(&quot;blue&quot;,&quot;red&quot;), lwd=2) 3.3 일반화 로그 순위 검정 \\[ CMH ~~\\chi^2 = \\frac {w_i[ \\sum (a-E_0(A))]^2}{ \\sum w_i^2 [m_1 m_2/(n-1)][n_1 n_2 /n^2] } \\] "],["-.html", "부록 A: 분할표 검정 A.1 \\(2 \\times 2\\) 분할표에서 두 비율의 비교 A.2 코크란-맨텔-핸젤 검정", " 부록 A: 분할표 검정 A.1 \\(2 \\times 2\\) 분할표에서 두 비율의 비교 다음과 같은 \\(2 \\times 2\\) 분할표에서 두 비율을 비교한다고 가정하자. 처리/반응여부 반응 반응 안함 합계 1 \\(a\\) \\(b\\) \\(n_1\\) 2 \\(c\\) \\(d\\) \\(n_2\\) 합계 \\(m_1\\) \\(m_2\\) \\(n\\) 처리 1과 2가 서로 독립인 집단에 적용되었다면 두 집단의 반응 비율이 같다는 가설 \\(H_0: p_1=p_2\\)를 다음과 같은 통계량으로 검정할 수 있다. \\[ z = \\frac{ \\hat p_1 - \\hat p_2} { \\sqrt{\\hat p (1-\\hat p) (1/n_1 + 1/n_2)}} \\] 위에서 \\[ \\hat p_1 = \\frac{a}{n_1} \\quad \\hat p_2 = \\frac{c}{n_2} \\quad \\hat p = \\frac{m_1}{n} \\] \\(n\\)이 충분히 크면 귀무가설 하에서 통계량 \\(z\\)는 정규분포를 따르므로 \\(|z|&gt;z_{\\alpha/2}\\)이면 귀무가설을 기각한다. 카이제곱 분포의 정의에 의하여 통계량 \\(z\\)의 제곱 \\(\\chi^2 = z^2\\)은 자유도가 1인 카이제곱분포를 따른다. 이때 통계량 \\(z\\)의 제곱은 \\(2 \\times 2\\) 분할표에서 동일성 검정에 대한 카이제곱 통계량(교과서 46 페이지)과 동일하다. \\[ \\chi^2 = z^2 = \\frac {n(ad-bc)^2}{n_1 n_2 m_1 m_2} \\] 만약에 귀무가설이 참이고 주변합 \\(n_1, n_2, m_1, m_2\\)가 고정되어 있다고 가정하면 첫번째 행, 첫번째 열의 값 \\(A=a\\)의 분포는 다음과 같은 초기하분포(Hypergeometric distribution)를 따른다. \\[ P(A=a) = \\frac{ \\binom{n_1}{a} \\binom{n_2}{m_1-a} } {\\binom{n}{m_1}} \\] 위의 초기하분포에서 \\(A=a\\)의 기대값과 분산은 다음과 같다. \\[ E_0(A) = \\frac{n_1 m_2}{n}, \\quad Var_0 (A) = \\frac{n_1 n_2 m_1 m_2}{n^2(n-1)} \\] 따라서 다음이 성립하며 \\[ ad-bc = n[a-E_0(A)], \\quad n_1 n_2 m_1 m_2 = n^2(n-1) Var_0 (A) \\] 이제 \\(2 \\times 2\\) 분할표에서 동일성 검정에 대한 카이제곱 통계량은 초기하분포와 다음과 같은 관계를 가진다. \\[ \\chi^2 = z^2 = \\frac {n(ad-bc)^2}{n_1 n_2 m_1 m_2} = \\frac{n}{n-1} \\left [ \\frac{a-E_0(A)}{\\sqrt{var_0(A)}} \\right ]^2 \\] A.2 코크란-맨텔-핸젤 검정 교과서 53-55 페이지 참조 전체 자료가 다음과 같이 \\(K\\) 개의 \\(2 \\times 2\\) 분할표로 나누어 진다면 처리/반응여부 반응 반응 안함 합계 1 \\(n_{k11}\\) \\(n_{k12}\\) \\(n_{k1+}\\) 2 \\(n_{k21}\\) \\(n_{k22}\\) \\(n_{k2+}\\) 합계 \\(n_{k+1}\\) \\(n_{k+2}\\) \\(n_{k}\\) 전체 자료에 대하여 처리의 반응률에 대한 다음과 같은 가설검정을 \\[ H_0: p_{k1} = p_{k2}, ~~k=1,2,\\dots,K \\quad \\text{vs.} \\quad H_0: not~~ H_0 \\] 다음과 같은 코크란-맨텔-핸젤 검정 통계량(CMH 검정 통계량)으로 검정할 수 있다. \\[ Q_{CMH} = \\frac { [ \\sum_{k=1}^ K n_{k11} - \\sum_{k=1}^K E(n_{k11}|H_0)]^2} { \\sum_{k=1}^K Var(n_{k11}|H_0)} \\] 위의 통계량에서 각 \\(2 \\times 2\\) 분할표에 대한 기대값과 분산은 다음과 같이 계산할 수 있다. \\[ E(n_{k11}|H_0) = \\frac{n_{k1+} n_{k+1}}{n_k} \\quad Var(n_{k11}|H_0) = \\frac{n_{k1+}n_{k2+} n_{k+1}n_{k+2}}{n^2_k(n_k-1)} \\] CMH 검정 통계량 \\(Q_{CMH}\\)은 귀무가설 \\(H_0\\)가 옳은 경우에 자유도 1을 가지는 카이제곱 분포를 따른다. "],["references.html", "References", " References "]]
