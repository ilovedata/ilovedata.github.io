[["index.html", "생존분석 Preface", " 생존분석 서울시립대학교 통계학과 이용희 2021-06-03 Preface 이 책은 통계학과 대학원생들을 위한 교재이며 생존분석에 대한 이론과 응용에 대하여 다루고자 합니다. 이 책에 나오는 설명, 그림, 예제의 일부는 이, 박, and 유 (2005) 과 Moore (2016) 에서 발췌하여 사용하였습니다. 이 책에서 사용된 기호, 표기법, 프로그램의 규칙과 쓰임은 다음과 같습니다. 스칼라(scalar)와 일변량 확률변수는 일반적으로 보통 글씨체의 소문자로 표기한다. 특별한 이유가 있는 경우 대문자로 표시할 것이다. 벡터, 행렬, 다변량 확률벡터는 굵은 글씨체로 표기한다. 통계 프로그램은 R을 이용합니다. 이 책에서 사용되는 R 패키지는 다음과 같습니다. library(ggplot2) library(dplyr) library(tidyr) library(survival) library(asaur) library(date) "],["survivalintro.html", "제 1 장 생존함수와 위험함수 1.1 생존함수와 위험함수 1.2 위험함수의 형태 1.3 평균 생존시간과 중위 생존시간 1.4 임의중도절단 1.5 모수의 최대가능도 추정", " 제 1 장 생존함수와 위험함수 1.1 생존함수와 위험함수 확률변수 \\(T\\)를 생존시간이라고 하고 \\(f(t)\\)를 확률밀도함수라고 하자. \\(T\\)의 누적분포함수(cumulative distribution function; CDF)는 다음과 같이 정의된다. \\[ F(t) = P(T \\le t) = \\int_0^t f(t) dt \\] 또한 생존함수(Survival function)은 다음과 같이 정의된다. \\[ S(t) = P (T &gt; t) = 1-F(t) \\] 위험함수(hazrd function)의 정의는 다음과 같으며 만약 생존시간이 \\(t\\) 보다 클때 바로 사망할 확률을 의미하며 순간위험율(instantaneous failure rate)이다. \\[\\begin{align} h(t) &amp; = \\lim_{dt \\rightarrow 0} \\frac{ P(t &lt; T \\le t+ dt | T &gt; t) }{dt} \\\\ \\notag &amp; = \\lim_{dt \\rightarrow 0} \\frac{1}{dt} \\frac{P(P(t &lt; T \\le t+ dt )}{P(T &gt;t)} \\\\ \\notag &amp; = \\frac{f(t)}{S(t)} \\tag{1.1} \\end{align}\\] 위험함수의 의미를 좀더 자세히 알아보자. 위험함수는 아주 짧은 시간에 일아날 사건의 확률로서 순간적인(instantaneous)인 의미를 가진다. 정의에서 보듯이 아주 짧은 시간에 일어나는 극한(\\(lim_{dt \\rightarrow 0}\\))의 의미이다. 위험함수는 확률로서 정의되지만 발생율(rate)로 이해할 수 있다. 위험함수를 정의에서 분모는 확률이고 분자는 시간으로 표시되기 때문에 마차 단위 시간당 일어나는 발생율로 이해할 수 있다. 또한 위험함수의 값은 [0,1] 사이에 있는 것이 아니기 때문에 단위 시간당 발생율로 이해하는 것이 편리하다 (\\(h(t) \\ge 0\\)). 위험함수는 조건부 확률로 정의되어 있다. 즉, 모든 개체에 대한 사건이 아니라 시간 \\(t\\)까지 살아있는 개체들에 대한 위험율이다. 생존분석에서는 생존함수보다 위험함수가 더 큰 의미를 가진다. 위험함수가 시간에 따라서 변하는 추세는 시간에 따른 위험의 변화를 나타내기 때문에 생존함수보다 위험의 변화에 대한 정보를 잘 파악할 수 있다. 위험함수와 생존함수의 관계 생존함수와 위험함수는 다음과 같은 관계를 가지고 있다. \\[\\begin{align*} h(t) &amp; = \\frac{f(t)}{S(t)} \\\\ &amp; = \\frac{f(t)}{1-F(t)} \\\\ &amp; = - \\frac {\\partial}{\\partial t} \\log [1-F(t)] \\\\ &amp; = - \\frac {\\partial}{\\partial t} \\log S(t) \\end{align*}\\] 따라서 다음의 관계가 성립힌다. \\[ S(t) = exp[-H(t)] \\] 여기서 \\[ H(t) = \\int_0^t h(t) dt \\] 이며 \\(H(t)\\)를 누적 위험함수(cumulative hazard function)라고 한다. 위의 식에서 볼 수 있듯이 위험함수를 알면 생존함수를 쉽게 구할 수 있고 또한 반대로 생존함수를 알면 위험함수를 자동적으로 알게된다. 1.2 위험함수의 형태 앞에서 언급했듯이 위험함수는 시간에 따른 위험의 변화를 말해준다. 생존분석에서 중요한 분포들과 예제를 가지고 다양한 위험함수의 형태를 알아보자. 예제 1.1 (지수분포) 만약 생존시간 \\(T\\)가 지수분포(Exponential distribution)을 따른다고 하자. \\[ f(t; \\lambda) = \\lambda e^{-\\lambda t} \\] 위에서 \\(\\lambda\\) 는 흔히 단위시간 당 사망률, 실패율(failure rate)라고 부르며 \\(E(T) = 1/\\lambda\\)이다. 생존함수(survaival function)와 위험함수(hazard function)은 다음과 같이 주어진다. \\[\\begin{align*} S(t) &amp; = P(T&gt;t) = 1 - P(T \\le t) \\\\ &amp; = 1 - \\int_0^t \\lambda e^{-\\lambda t} \\\\ &amp; = 1 - (1-e^{-\\lambda t} ) \\\\ &amp; = e^{-\\lambda t} \\\\ h(t) &amp; = \\frac{f(t)}{S(t)} \\\\ &amp; = \\lambda e^{-\\lambda t} / e^{-\\lambda t} \\\\ &amp; = \\lambda \\end{align*}\\] 누적위험함수는 아래와 같다. \\[ H(t) = \\int_0^t h(t) dt = \\lambda t \\] 생존시간이 지수분포를 따른다면 위험함수는 시간에 관계없이 상수 \\(\\lambda\\)이다. 이렇게 시간에 따라서 위험함수가 상수인 경우는 현실에서는 거의 나타나지 않는다. 위험함수가 상수라는 것은 시간이 지나도 (1) 제품이 고정날 또는 (2) 사람이 사망할 위험성이 변허지 않는다는 의미이다. 지수분포는 생존분석에서 중요한 의미를 가진다. 즉, 생존시간이 지수분포를 따르면 개체는 얼마나 시간이 경과했는지 정보가 없다는 것이며 주어진 시각에 사건이 일어나지 않았다면 바로 다음 시간에 사건이 일어날 확률은 언제나 동일하다. \\(\\blacksquare\\) 예제 1.2 (와이블분포) 만약 생존시간이 와이블 분포(Weibull distribution)를 따른다면 확률밀도함수는 다음과 같다. \\[ f(t) = \\frac{\\lambda t^{\\lambda-1}}{\\theta^\\lambda} \\exp \\left[ - \\left(\\frac{t}{\\theta} \\right)^\\lambda \\right], \\quad \\theta,\\lambda&gt;0, t \\geq 0. \\] 평균은 \\(E(T)=\\theta \\Gamma(1+1/\\lambda)\\) 이다. 여기서 \\(\\lambda=1\\)이면 지수분포가 된다. 이때 생존 함수는 다음과 같다. \\[\\begin{eqnarray*} S(t) &amp;=&amp; 1-\\int_0^t \\frac{\\lambda t^{\\lambda-1}}{\\theta^\\lambda} \\exp \\left[ - \\left( \\frac{t}{\\theta} \\right)^\\lambda \\right] dt \\\\ &amp;=&amp; \\exp \\left[ - \\left( \\frac{t}{\\theta} \\right)^\\lambda \\right]. \\end{eqnarray*}\\] 또한 위험함수는 다음과 같다. \\[\\begin{eqnarray*} h(t) &amp;=&amp; \\frac{f(t)}{S(t)} \\\\ &amp;=&amp; \\frac{\\frac{\\lambda t^{\\lambda-1}}{\\theta^\\lambda} \\exp \\left[ - \\left( \\frac{t}{\\theta} \\right)^\\lambda \\right]}{\\exp \\left[ - \\left( \\frac{t}{\\theta} \\right)^\\lambda \\right]} \\\\ &amp;=&amp; \\left( \\frac{\\lambda }{\\theta^\\lambda} \\right) t^{\\lambda-1}. \\end{eqnarray*}\\] 위에서 볼 수 있듯이 \\(\\lambda=1\\)이면 지수분포가 되고 위험함수는 상수이다. 만약에 \\(\\lambda&gt;1\\)이면 위험함수는 시간에 따라 증가하며 \\(\\lambda&lt;1\\)이면 위험함수는 감소한다. 누적위험함수는 아래와 같다. \\[ H(t) = \\int_0^t h(t) dt = (t/\\theta)^\\lambda \\] 다음은 모수의 변화에 따른 와이블 분포의 위험함수이다. weibHaz &lt;- {function(x, shape, scale) dweibull(x, shape=shape, scale=scale)/pweibull(x, shape=shape, scale=scale, lower.tail=F)} curve(weibHaz(x, shape=1.5, scale=1/0.03), from=0, to=80, ylab=&#39;Hazard&#39;, xlab=&#39;Time&#39;, col=&quot;blue&quot;) curve(weibHaz(x, shape=1.0, scale=1/0.03), from=0, to=80, ylab=&#39;Hazard&#39;, xlab=&#39;Time&#39;, add=T, col=&quot;black&quot;) curve(weibHaz(x, shape=0.75, scale=1/0.03), from=0, to=80, ylab=&#39;Hazard&#39;, xlab=&#39;Time&#39;, add=T, col=&quot;red&quot;) text(45, 0.065, expression(lambda == 1.50), col=&quot;red&quot;, cex=1.3) text(58, 0.065, expression(theta==1/0.03), col=&quot;red&quot;, cex=1.3) text(45, 0.015, expression(lambda == 0.75), col=&quot;blue&quot;, cex=1.3) text(58, 0.015, expression(theta==1/0.03), col=&quot;blue&quot;, cex=1.3) text(45, 0.034, expression(lambda== 1.00), col=&quot;black&quot;, cex=1.3) text(58, 0.034, expression(theta==1/0.03), col=&quot;black&quot;, cex=1.3) \\(\\blacksquare\\) 예제 1.3 (미국 여자와 남자의 연령에 따른 사망위험율) 다음 그림은 미국 여자와 남자의 연령에 따른 사망위험율을 나타내는 위험함수를 보여주는 그림이다. Y 축은 로그 스케일로 그린 그림이며 2004년의 자료를 이용하여 그린 그림이다. 태어난 날과 그 후 몇 주동안은 매우 사망위험이 높다가 급격하게 떨어진다. 그리고 10대에서 약간의 증가 현상을 보이며 조금 감쏘하다가 시간이 지날수록 위험율이 완만하게 증가한다. 주목할 점은 남자가 여자보다 사망의 위험이 언제나 크다는 것이며 이는 잘 알려진 사실이다. tm &lt;- c(0, # birth 1/365, # first day of life 7/365, # seventh day of life 28/365, # fourth week of life 1:107) # subsequent years hazMale &lt;- as.numeric(survexp.us[,&quot;male&quot;,&quot;2004&quot;]) # 2004 males hazFemale &lt;- as.numeric(survexp.us[,&quot;female&quot;,&quot;2004&quot;]) # 2004 females tm.diff &lt;- diff(tm) survMale &lt;- exp(-cumsum(hazMale*tm.diff)*365.24) survFemale &lt;- exp(-cumsum(hazFemale*tm.diff)*365.24) # Figure 2.1.2 log hazard and survival for US males and females in 2004 par(mfrow=c(2,1), # two rows and one column of plots mar=c(4.2,5,2,2)) # set margins for the lower, left, top, and righ of each plot logHazMale &lt;- log(hazMale) logHazFemale &lt;- log(hazFemale) plot(logHazMale ~ tm[-1], type=&quot;l&quot;, xlab=&quot;Age in years&quot;, # x axis label ylab=&quot;Hazard&quot;,col=&quot;blue&quot;, # y azis label lwd=2, # double line width las=1, # make y axis labels perpendicular to axis axes=F, cex.lab=1.3, cex.axis=1.3) # make blue line solid lines(logHazFemale ~ tm[-1],type=&quot;l&quot;, col=&quot;red&quot;,lwd=2, lty=2) # add a red dashed line to the plot yyLabs &lt;- c(1e-07, 1e-06, 1e-05, 1e-04, 1e-03, 1e-02) yyLabsLog &lt;- log(yyLabs) axis(2, at=yyLabsLog, labels=c(expression(10^-7), expression(10^-6), expression(10^-5), expression(10^-4), expression(10^-3), expression(10^-2)), las=1) axis(1, cex.axis=1.3) legend(&quot;bottomright&quot;, legend=c(&quot;males&quot;,&quot;females&quot;), lty=c(1,2), col=c(&quot;blue&quot;,&quot;red&quot;), lwd=2, cex=1.3) title(&quot;Hazards for US males and females in 2004&quot;) tm.diff &lt;- diff(tm) # same length as &quot;tm&quot; survMale &lt;- exp(-cumsum(hazMale*tm.diff)*365.24) # survival probs for males survFemale &lt;- exp(-cumsum(hazFemale*tm.diff)*365.24) # survival probs for females #windows(width=7,height=5) plot(survMale ~ tm[-1],type=&quot;l&quot;, # lower case &quot;L&quot; indicates line plot xlab=&quot;Age in years&quot;, # x axis label ylab=&quot;Survival probability&quot;, # y azis label col=&quot;blue&quot;, # line color lwd=2, # double line width las=1, # make y axis labels perpendicular to axis ylim=c(0,1), cex.lab=1.3, cex.axis=1.3) # y axis limit ranges from 0 to 1 lines(survFemale ~ tm[-1], col=&quot;red&quot;, lwd=2, lty=2) # add a red dashed line to the plot legend(&quot;bottomleft&quot;, legend=c(&quot;males&quot;,&quot;females&quot;), lty=c(1,2), col=c(&quot;blue&quot;,&quot;red&quot;), lwd=2, cex=1.3) title(&quot;Survival of US males and females in 2004&quot;) \\(\\blacksquare\\) 1.3 평균 생존시간과 중위 생존시간 평균 생존시간 \\(\\mu\\) 다은과 같이 정의된다. \\[ \\mu = \\int_{0}^\\infty t f(t) dt \\] 잘 알려진 생존함수의 공식 \\(f(t) = dS(t)/dt\\)와 부분 적분 공식(integration by part)를 이용하면 평균 생존시간 \\(\\mu\\) 다은과 같이 구할 수 있다. \\[ \\mu = \\int_0^\\infty S(t)dt \\] 중위 생존시간은 \\(t_{med}\\) 다음 방정식을 만족하는 \\(t\\)의 값이다. \\[ t_{med} = \\inf ~ \\{t~|~ S(t) \\le 1/2 \\} \\] 1.4 임의중도절단 중도 절단 자료 생존시간 \\(T_1, T_2, \\dots, T_n\\)을 독립적으로 분포 \\(f_\\theta(t)\\)에서 추출하였다고 가정하고 중도절단시간 \\(C_1, C_2, \\dots, C_n\\)도 독립적으로 분포 \\(g(c)\\)에서 추출하였다고 가정하자. 생존시간 \\(T\\)와 중도절단시간 \\(C\\)가 서로 독립이라고 가정하며 이러한 가정을 임의 중도절단(random censoring)이라고 한다. 이제 관측한 생존시간 \\(X_i\\)는 다음과 같이 정의한다. \\[ X_i = \\min (T_i, C_i) \\quad i=1,2,\\dots, n \\] 또한 절단 표시변수 \\(\\delta_i\\)는 다음과 같이 정의한다. 표시변수 \\(\\delta_i\\) 가 1의 값을 가지면 실제 생존시간을 관측한 것이고 0이면 절단된 자료이다. \\[ \\delta_i = \\begin{cases} 1 &amp; T_i &lt; C_i \\\\ 0 &amp; T_i &gt; C_i \\end{cases} \\] 따라서 중도절단이 있는 자료는 다음과 같은 각 개체에 대한여 쌍으로 구성된 관측값이 얻어진다. \\[ (X_1, \\delta_1), (X_2, \\delta_2), \\dots, (X_n, \\delta_n) \\] 1.5 모수의 최대가능도 추정 이제 생존시간 \\(T\\)의 분포 \\(F_\\theta(t)\\) 가 주어졌을 때 표본 \\((x_i, \\delta_i)\\)의 가능도 함수 \\(L\\) 는 다음과 같이 나타낼 수 있다. \\[ L(\\theta; x, \\delta) = \\prod_{i \\in UC} P_\\theta(T_i= x_i ) \\prod_{i \\in C} P_\\theta(T_i &gt; x_i ) = \\prod_{i \\in UC} f_\\theta( x_i ) \\prod_{i \\in C} [1-F_\\theta( x_i )] \\] 여기서 집합 \\(UC\\)는 실제 생존시간이 관측된 자료들, 집합 \\(C\\)는 중도절단된 자료을 의미한다. 모수의 최대가능도 추정은 \\(L(\\theta; X, \\delta)\\)를 최대로 하는 \\(\\theta\\)를 찾는 방법이다. 이제 예제로서 생존시간의 분포가 지수분포를 따른다고 가정하고 가능도함수를 구해보자. \\[\\begin{align*} L(\\lambda; x, \\delta) &amp; = \\prod_{i \\in UC} P_\\lambda(T_i= x_i ) \\prod_{i \\in C} P_\\lambda(T_i &gt; x_i ) \\\\ &amp; = \\prod_{i \\in UC} f_\\lambda( x_i ) \\prod_{i \\in C} [1-F_\\lambda( x_i )] \\\\ &amp; = \\prod_{i=1}^n \\left [ \\lambda e^{-\\lambda x_i} \\right ]^{\\delta_i} \\left [e^{-\\lambda x_i} \\right ]^{1-\\delta_i} \\\\ &amp; = \\prod_{i=1}^n \\lambda^{\\delta_i} e^{-\\lambda x_i} \\\\ &amp; = \\lambda^{ \\sum_{i=1}^n \\delta_i} e^{-\\lambda \\sum_{i=1}^n x_i} \\end{align*}\\] 이제 위의 가능도함수를 최대화하는 모수를 찾기위하여 로그가능도함수를 고려하고 \\[ \\ell (\\lambda; x, \\delta) = \\log L(\\lambda; x, \\delta) = \\log \\lambda \\sum_{i=1}^n \\delta_i - \\lambda \\sum_{i=1}^n x_i \\] 로그가능도함수를 모수 \\(\\lambda\\)에 대하여 미분하고 0으로 놓고 풀면 최대가능도 추정량을 구할 수 있다. \\[ \\frac{\\partial}{\\partial \\lambda} \\ell (\\lambda; x, \\delta) = \\frac{\\sum_{i=1}^n \\delta_i}{\\lambda} - \\sum_{i=1}^n x_i = 0 \\] 따라서 최대가능도 추정량은 다음과 같이 주어진다. \\[ \\hat \\lambda_{ML} = \\frac{\\sum_{i=1}^n \\delta_i}{\\sum_{i=1}^n x_i} \\] 만약 중도절단자료가 없다면 최대가능도 추정량은 일반적인 경우와 같이 다음과 같다. \\[ \\hat \\lambda_{ML} = \\frac{n}{\\sum_{i=1}^n x_i} \\] "],["estsurvival.html", "제 2 장 생존함수의 추정 2.1 생명표방법을 이용한 생존함수 추정 2.2 누적한계추정법에 의한 생존함수 추정 2.3 Nelson-Aalen 추정량 2.4 중위 생존시간 2.5 예제", " 제 2 장 생존함수의 추정 2.1 생명표방법을 이용한 생존함수 추정 다음은 이, 박, and 유 (2005) 의 7.2.1 절에 나오는 생명표방법에 대한 요약 설명이다. 시간 \\((0, \\infty)\\)구간을 다음과 같은 경계선을 이용하여 \\(k+1\\) 개의 구간으로 나누었다고 가정하자. (\\(t_0=0\\)) \\[ (t_0, t_1] \\quad (t_1,t_2] \\quad \\dots \\quad (t_{k-1}, t_k] \\quad (t_k, \\infty) \\] 생존함수는 다음과 같은 조건부 확률의 축차식으로 구할 수 있다. \\[\\begin{align} S(t_i) &amp; = p(T&gt;t_i) \\\\ &amp; = P(T &gt; t_i | T &gt; t_{i-1}) P(T &gt; t_{i-1}) \\notag \\\\ &amp; = P(T &gt; t_i | T &gt; t_{i-1}) P(T &gt; t_{i-1} | T &gt; t_{i-2}) P(T &gt; t_{i-2} ) \\notag \\\\ &amp; = \\cdots \\notag \\\\ &amp; = P(T &gt; t_i | T &gt; t_{i-1}) P(T &gt; t_{i-1} | T &gt; t_{i-2}) P(T &gt; t_{i-2} ) \\dots P(T&gt; t_2 | T &gt; t_1)P(T &gt; t_1) \\tag{2.1} \\end{align}\\] 만약 주어진 구간 \\((t_{i-1}, t_i]\\) 에서 시망자의 수 \\(d_i\\) 와 중도절단자의 수 \\(c_i\\) 가 주어졌다면 조건부 생존 함수는 다음과 같이 추정할 수 있다. \\[ \\hat P(T &gt; t_{i} | T &gt; t_{i-1}) = 1 -\\frac{d_i}{n&#39;_i}\\] 위에서 \\(i\\) 번째 구간의 위험그룹 인원수 \\(n_i = n_{i-1} - d_{i-1} -c_{i-1}\\) 로 주어지면 유효인원수(effective sample size) \\(n&#39;_i\\) 는 다음과 같이 계산한다. \\[ n&#39;_i = n_i - \\frac{c_i}{2} \\] 생존함수의 추정은 조건부 확률의 축차식을 이용하여 다음과 같이 계산한다. \\[ \\hat S(t_i) = \\prod_{k=1}^i \\left ( 1-\\tfrac{d_k}{n&#39;_k} \\right ) \\] 이와 같이 주정된 생존함수의 분산은 다음과 같은 그린우드의 공식으로 구할 수 있다. \\[ \\widehat {Var} (\\hat S (t_i) ) = \\hat S(t_i) \\sum_{k=1}^i \\frac{d_k}{ n_k^{&#39;} ( n_k^{&#39;} -d_k)} \\] 생명표방법을 이용한 생존함수 추정은 표를 이용하면 편리하다. 다음은 각 구간에서 사망자수와 중도절단수가 주어진 경우 생명표방법을 이용하여 생존함수를 추정하는 예를 보여준다. 구간 위험그룹인원수 사망자 수 중도절단 수 유효인원수 사망율 생존율 생존함수 추정 \\(I_i\\) \\(n_i\\) \\(d_i\\) \\(c_i\\) \\(n&#39;_i\\) \\(\\tfrac{d_i}{n&#39;_i}\\) \\(1-\\tfrac{d_i}{n&#39;_i}\\) \\(\\hat S(t_i)\\) 0-1 115 47 19 105.5 0.4455 0.5545 1.000 1-2 49 5 17 40.5 0.1235 0.8765 0.5545 2-3 27 2 15 19.5 0.1026 0.8974 0.4860 3-4 10 2 2 9.0 0.2222 0.7778 0.4362 4-5 6 0 6 3.0 0.0000 1.00 0.3393 R 에서는 패키지 KMsurv 의 함수 lifeTable() 를 이용하면 생명표방법을 이용한 생존함수 추정을 할 수 있다. 위의 표에 나타난 자료를 이용하여 생명표방법을 이용한 생존함수 추정값을 구해보자. death1 &lt;- c(47, 5, 2, 2, 0) censor1 &lt;- c(19, 17, 15, 2, 6) intEndpts &lt;- 0:(length(death1)) N &lt;- sum(censor1) + sum(death1) lfres0 &lt;- lifetab(tis = intEndpts, ninit=N, nlost=censor1, nevent=death1) lfres0[c(&quot;nsubs&quot;, &quot;nevent&quot;, &quot;nlost&quot;, &quot;nrisk&quot;, &quot;pdf&quot;, &quot;surv&quot;,&quot;se.surv&quot;)] ## nsubs nevent nlost nrisk pdf surv se.surv ## 0-1 115 47 19 105.5 0.44550 1.0000 0.00000 ## 1-2 49 5 17 40.5 0.06846 0.5545 0.04839 ## 2-3 27 2 15 19.5 0.04985 0.4860 0.05119 ## 3-4 10 2 2 9.0 0.09693 0.4362 0.05680 ## 4-5 6 0 6 3.0 NA 0.3393 0.07487 이, 박, and 유 (2005) 의 예제 7-1 에 나타난 자료를 이용하여 생명표방법을 이용한 생존함수 추정값을 구해보자. death2 &lt;- c(456, 226, 152, 171, 135, 125, 83, 74, 51, 42, 43, 34, 18, 9, 6, 0) censor2 &lt;- c(0, 39, 22, 23, 24, 107, 133, 102, 68, 64, 45, 53, 33, 27, 23, 30) intEndpts = 0:(length(death2)) N &lt;- sum(censor2) + sum(death2) lfres71 &lt;- lifetab(tis = intEndpts, ninit=N, nlost=censor2, nevent=death2) lfres71[c(&quot;nsubs&quot;, &quot;nevent&quot;, &quot;nlost&quot;, &quot;nrisk&quot;, &quot;pdf&quot;, &quot;surv&quot;,&quot;se.surv&quot;)] ## nsubs nevent nlost nrisk pdf surv se.surv ## 0-1 2418 456 0 2418.0 0.18859 1.0000 0.000000 ## 1-2 1962 226 39 1942.5 0.09440 0.8114 0.007955 ## 2-3 1697 152 22 1686.0 0.06464 0.7170 0.009179 ## 3-4 1523 171 23 1511.5 0.07380 0.6524 0.009735 ## 4-5 1329 135 24 1317.0 0.05931 0.5786 0.010138 ## 5-6 1170 125 107 1116.5 0.05813 0.5193 0.010304 ## 6-7 938 83 133 871.5 0.04392 0.4611 0.010380 ## 7-8 722 74 102 671.0 0.04601 0.4172 0.010451 ## 8-9 546 51 68 512.0 0.03697 0.3712 0.010579 ## 9-10 427 42 64 395.0 0.03554 0.3342 0.010717 ## 10-11 321 43 45 298.5 0.04303 0.2987 0.010891 ## 11-12 233 34 53 206.5 0.04209 0.2557 0.011124 ## 12-13 146 18 33 129.5 0.02968 0.2136 0.011397 ## 13-14 95 9 27 81.5 0.02031 0.1839 0.011766 ## 14-15 59 6 23 47.5 0.02066 0.1636 0.012260 ## 15-16 30 0 30 15.0 NA 0.1429 0.013300 2.2 누적한계추정법에 의한 생존함수 추정 의학연구에서는 사람이나 동물을 대상으로 연구를 진행하는데 이러한 경우 실험 대상자의 수도 많지 않으며 생존함수가 어떤 분포를 따르는지 미리 알기 힘들다. 따라서 생존함수를 추정할 때 비모수적 방법(nonparametric methods)를 이용한다. 비모수적 방법의 대표적인 예는 위에서 고혀한 생존함수를 축차적인 조건부 확률의 곱으로 나타내는 공식 (??) 을 이용한다. 비모수적 방법으로 생존함수를 추정하는 경우 시간에 따른 생존함수의 변화가 각 관측점에서 일어나게 된다. 표본에서 괸측된 생존시간들을 순서대로 \\(t_1 &lt; t_2 &lt; \\dots &lt; t_n\\) 나열한 다음 누적한계추정법(product limit estimator; Kaplan-Meier estimator)은 생존함수를 다음의 식으로 추정한다. \\[\\begin{equation} \\hat S(t) = \\prod_{t_i \\le t} \\left ( 1-\\frac{d_i}{n_i} \\right)^{\\delta_i} = \\prod_{t_i \\le t} \\left ( \\frac{n_i-d_k}{n_i} \\right)^{\\delta_i} \\tag{2.2} \\end{equation}\\] \\(n_i\\) : 시간 \\(t_i\\) 바로 직전까지 중도절단되지 않고 생존한 사람의 수 (위험집단의 수; number at risk) \\(d_i\\) : 시간 \\(t_i\\) 에 사망한 사람의 수 생존함수 추정량 \\(\\hat S(t)\\) 의 분산은 다음과 같이 주어진다. \\[ Var(\\hat S(t)) = [\\hat S(t)]^2 \\sum_{t_i \\le t} \\frac{d_i}{n_i(n_i-d_i)} \\] 위의 분산추정량으로 생존함수의 신뢰구간을 구하면 [0,1]의 범위를 벗어나는 경우가 생긴다. 이러한 단점을 보완하기 위하여 생존함수의 변환(log-log transformation)을 이용한 신뢰구간을 구하는 방법을 주로 사용한다. \\[ Var\\left ( \\log \\left [ - \\log \\hat S(t) \\right ] \\right ) \\approx \\frac{1}{[\\hat S(t)]^2 } \\sum_{t_i \\le t} \\frac{d_i}{n_i(n_i-d_i)} \\] 예제 2.1 (누적한계추정법) 다음 주어진 11명에 대한 생존자료에 대하여 누적한계추정법으로 생존함수를 추정하는 방법을 알아보자. \\(+\\)는 중도절단된 자료를 표시한다. \\[ 9,~~13,~~13+,~~18,~~23~~,28+,~~31,~~,34,~~,45+,~~,48,~~161+ \\] 누적한계추정법은 생존함수를 다음과 같이 축차적으로 구할 수 있다. \\[\\begin{align*} \\hat S(0) &amp; = 1 \\\\ \\hat S(9) &amp; = \\hat S(0) \\times \\frac{10}{11} = 0.91 \\\\ \\hat S(13) &amp; = \\hat S(9) \\times \\frac{9}{10} = 0.82 \\\\ \\hat S(18) &amp; = \\hat S(13) \\times \\frac{7}{8} = 0.72 \\\\ \\hat S(23) &amp; = \\hat S(18) \\times \\frac{6}{7} = 0.61 \\\\ \\hat S(31) &amp; = \\hat S(23) \\times \\frac{4}{5} = 0.49 \\\\ \\hat S(34) &amp; = \\hat S(31) \\times \\frac{3}{4} = 0.37 \\\\ \\hat S(48) &amp; = \\hat S(34) \\times \\frac{1}{2} = 0.18 \\end{align*}\\] \\(\\blacksquare\\) 다음은 예제 자료에 대하여 누적한계추정법으로 생존함수를 추정하는 R 프로그램이다. t &lt;- c(9, 13, 13, 18 ,23 ,28, 31, 34 ,45 ,48 ,161) cens &lt;- c(1,1,0,1,1,0,1,1,0,1,0) df &lt;- Surv(t, cens) df ## [1] 9 13 13+ 18 23 28+ 31 34 45+ 48 161+ res.km &lt;- survfit(Surv(t, cens)~1, conf.type=&quot;log-log&quot;) res.km ## Call: survfit(formula = Surv(t, cens) ~ 1, conf.type = &quot;log-log&quot;) ## ## n events median 0.95LCL 0.95UCL ## 11 7 31 13 NA summary(res.km) ## Call: survfit(formula = Surv(t, cens) ~ 1, conf.type = &quot;log-log&quot;) ## ## time n.risk n.event survival std.err lower 95% CI upper 95% CI ## 9 11 1 0.909 0.0867 0.5081 0.987 ## 13 10 1 0.818 0.1163 0.4474 0.951 ## 18 8 1 0.716 0.1397 0.3502 0.899 ## 23 7 1 0.614 0.1526 0.2658 0.835 ## 31 5 1 0.491 0.1642 0.1673 0.753 ## 34 4 1 0.368 0.1627 0.0928 0.657 ## 48 2 1 0.184 0.1535 0.0117 0.525 plot(res.km) 2.3 Nelson-Aalen 추정량 Nelson-Aalen 추정량은 생존함수와 위험함수의 관계를 이용하는 추정량이다. 누적 위험함수 \\(H(t)\\) 는 시간 \\(t\\)까지 위험함수의 합이므로 다음과 같이 추정할 수 있다. \\[ \\hat H(t) = \\sum_{t_i \\le t} \\frac{d_i}{n_i} \\] 따라서 생존함수과의 관계를 이용하면 Nelson-Aalen 추정량은 다음과 같이 주어진다. \\[ \\hat S(t) = e^{- \\hat H(t)} \\] 다음은 예제 자료에 대하여 Nelson-Aalen 추정량(type=\"fh\")으로 생존함수를 추정하는 R 프로그램이다. res.fh &lt;- survfit(Surv(t, cens)~1, conf.type=&quot;log-log&quot;, type=&quot;fh&quot;) res.fh ## Call: survfit(formula = Surv(t, cens) ~ 1, conf.type = &quot;log-log&quot;, type = &quot;fh&quot;) ## ## n events median 0.95LCL 0.95UCL ## 11 7 34 13 NA summary(res.fh) ## Call: survfit(formula = Surv(t, cens) ~ 1, conf.type = &quot;log-log&quot;, type = &quot;fh&quot;) ## ## time n.risk n.event survival std.err lower 95% CI upper 95% CI ## 9 11 1 0.913 0.083 0.5245 0.987 ## 13 10 1 0.826 0.112 0.4655 0.953 ## 18 8 1 0.729 0.134 0.3716 0.904 ## 23 7 1 0.632 0.147 0.2890 0.844 ## 31 5 1 0.517 0.159 0.1935 0.768 ## 34 4 1 0.403 0.160 0.1183 0.679 ## 48 2 1 0.244 0.156 0.0327 0.560 plot(res.fh) 누적한계추정법과 Nelson-Aalen 추정법으로 구한 생존함수의 추정치를 비교해보면 매우 유사하다. compsurv &lt;- data.frame(time = res.km$time, estKM = res.km$surv, estNA = res.fh$surv) compsurv ## time estKM estNA ## 1 9 0.9091 0.9131 ## 2 13 0.8182 0.8262 ## 3 18 0.7159 0.7291 ## 4 23 0.6136 0.6321 ## 5 28 0.6136 0.6321 ## 6 31 0.4909 0.5175 ## 7 34 0.3682 0.4030 ## 8 45 0.3682 0.4030 ## 9 48 0.1841 0.2444 ## 10 161 0.1841 0.2444 plot(res.fh, col =&quot;blue&quot;) lines(res.km, col = &quot;red&quot;) 그림 2.1: 누적한계추정법(파랑선)과 Nelson-Aalen 추정법(빨간선)의 비교 2.4 중위 생존시간 중위 생존시간의 추정량은 \\(\\hat t_{med}\\) 다음 방정식을 만족하는 \\(t\\)의 값이다. \\[ \\hat t_{med} = \\inf ~ \\{t~|~ \\hat S(t) \\le 1/2 \\} \\] res.km ## Call: survfit(formula = Surv(t, cens) ~ 1, conf.type = &quot;log-log&quot;) ## ## n events median 0.95LCL 0.95UCL ## 11 7 31 13 NA 2.5 예제 2.5.1 예제 7-2 교과서 이, 박, and 유 (2005) 의 예제 7-2 에 나온 자료에 대하여 누적한게추정법으로 구한 생존함수의 추정결과는 다음과 같다. t &lt;- c(3, 4, 4.5, 5.5, 6.0, 6.4, 6.5, 7.0, 7.5, 8.4, 10, 10, 12, 15) cens &lt;- c(1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1) res.km72 &lt;- survfit(Surv(t, cens)~1, conf.type=&quot;log-log&quot;) summary(res.km72) ## Call: survfit(formula = Surv(t, cens) ~ 1, conf.type = &quot;log-log&quot;) ## ## time n.risk n.event survival std.err lower 95% CI upper 95% CI ## 3.0 14 1 0.929 0.0688 0.5908 0.990 ## 4.5 12 1 0.851 0.0973 0.5234 0.961 ## 5.5 11 1 0.774 0.1152 0.4493 0.921 ## 6.0 10 1 0.696 0.1270 0.3784 0.874 ## 6.4 9 1 0.619 0.1344 0.3119 0.821 ## 6.5 8 1 0.542 0.1381 0.2502 0.762 ## 7.0 7 1 0.464 0.1384 0.1934 0.699 ## 7.5 6 1 0.387 0.1352 0.1418 0.630 ## 10.0 4 1 0.290 0.1315 0.0791 0.547 ## 12.0 2 1 0.145 0.1219 0.0108 0.439 ## 15.0 1 1 0.000 NaN NA NA plot(res.km72) 2.5.2 예제 교과서 Moore (2016) 의 29페이지에 나오는 예제를 소개한다. 위암환자들에게 치료제인 Xelox를 투약하는 실제 2상 임상실험의 자료를 분석한 예이다. 관심있는 변수는 “progression-free time” 으로서 임상실험에 참가한 시점부터 회복이 되거나 사망하거나 둘 중에 빠르게 나타난 시간이다. 아래는 누적한계추정법으로 구한 생존함수의 추정치와 그림(생존함수와 누적위험함수)이다. timeMonths &lt;- gastricXelox$timeWeeks*7/30.25 result.km &lt;- survfit(Surv(timeMonths, delta) ~ 1, conf.type=&quot;log-log&quot;, data=gastricXelox) # median survival and 95% confidence interval is printed as follows: result.km ## Call: survfit(formula = Surv(timeMonths, delta) ~ 1, data = gastricXelox, ## conf.type = &quot;log-log&quot;) ## ## n events median 0.95LCL 0.95UCL ## 48.00 32.00 10.30 5.79 15.27 plot(result.km, mark=&quot;|&quot;, ylab=&quot;Survival probability&quot;, xlab=&quot;Time in months&quot;, cex.axis=1.5, cex.lab=1.5, lwd=1.5) plot(result.km, cumhaz=TRUE, mark=&quot;|&quot;, ylab=&quot;cumulative hazrd&quot;, xlab=&quot;Time in months&quot;, cex.axis=1.5, cex.lab=1.5, lwd=1.5) "],["logrank.html", "제 3 장 비모수적 방법을 이용한 생존함수의 비교 3.1 비모수적 방법을 이용한 생존함수의 비교 3.2 일반화 로그 순위 검정 3.3 예제", " 제 3 장 비모수적 방법을 이용한 생존함수의 비교 3.1 비모수적 방법을 이용한 생존함수의 비교 두 개의 독립 집단에 대하여 다음과 같이 생존시간을 관측하였다고 하자. \\[\\begin{align*} \\text{group 1} \\quad &amp; (X_{11}, \\delta_{11}), (X_{12}, \\delta_{12}) , \\dots ,(X_{1 n_1}, \\delta_{1 n_1}) \\\\ \\text{group 2} \\quad &amp; (X_{21}, \\delta_{21}), (X_{22}, \\delta_{22}) , \\dots ,(X_{2 n_2}, \\delta_{2 n_2}) \\\\ \\end{align*}\\] 두 개의 집단에 대한 생존함수가 동일하다는 다음 가설을 고려하자. \\[ H_0: S_1 = S_2 \\quad H_1: S_1 \\ne S_2 \\] 위의 가설은 두 집단의 생존시간을 모두 합쳐서 순서대로 나열하고 중도절단이 없는 자료들에서 다음과 같은 \\(2\\times 2\\) 분할표를 작성한 다음 CMH-검정 통계량(코크란-맨텔-핸젤 검정 통계량)을 이용하여 검정할 수 있다. 처리/반응여부 사망 생존 합계 1 \\(A=a\\) \\(b\\) \\(n_1\\) 2 \\(c\\) \\(d\\) \\(n_2\\) 합계 \\(m_1\\) \\(m_2\\) \\(n\\) 다음과 같은 예제 자료를 고려해보자 \\[\\begin{align*} \\text{[group 1]} \\quad &amp; 3,~~5,~~7,~~9+~~, 18 \\\\ \\text{[group 2]} \\quad &amp; 12,~~ 19,~~ 20,~~ 20+,~~ 33+ \\\\ \\end{align*}\\] 두 표본을 합쳐서 순서대로 놓으면 다음과 같다. \\[ 3,~~5,~~7,~~9+~~12,~~ 18, ~~ 19,~~ 20,~~ 20+,~~ 33+ \\] 이제 중도절단이 없는 자료들(\\(3,5,7,12,18,19,20\\))에 대하여 각각 \\(2\\times 2\\) 분할표를 작성하고 CMH-검정 통계량을 계산할 수 있다. 먼저 가장 짧은 생존시간 \\(X=3\\)이 관측 된 경우 \\(2\\times 2\\) 분할표를 작성해보자. 첫번째 분할표 처리/반응여부 사망 생존 합계 1 1 4 5 2 0 5 5 합계 1 9 10 첫번째 분할표에서 귀무가설이 참인 경우, 즉 두 그룹의 생존시간에 대한 분포가 동일한 경우 \\(A\\) 에 대한 기대값은 다음과 같다. \\[ E_0(A) = \\frac{n_1 m_1}{n} = \\frac{(5)(1)}{10} = 0.5 \\] 또한 분산은 다음과 같다. \\[ Var_0 (A) = \\frac{n_1 n_2 m_1 m_2}{n^2(n-1)} =\\frac{m_1 m_2}{(n-1)} \\frac{n_1 n_2}{n^2} = \\frac{(1)(9)}{9} \\frac{(5)(5)}{10^2} = 0.25 \\] 이제 두 번째 생존시간 \\(X=5\\)이 관측 된 경우 \\(2\\times 2\\) 분할표를 작성해보자. 두번째 분할표 처리/반응여부 사망 생존 합계 1 1 3 4 2 0 5 5 합계 1 8 9 두번째 분할표에서 귀무가설이 참인 경우, 즉 두 그룹의 생존시간에 대한 분포가 동일한 경우 \\(A\\) 에 대한 기대값은 다음과 같다. \\[ E_0(A) = \\frac{n_1 m_1}{n} = \\frac{(4)(1)}{9} = 0.44 \\] 또한 분산은 다음과 같다. \\[ Var_0 (A) = \\frac{n_1 n_2 m_1 m_2}{n^2(n-1)} = \\frac{(1)(8)}{8} \\frac{(5)(4)}{9^2} = 0.2469 \\] 이제 네 번째 생존시간 \\(X=12\\)이 관측 된 경우 \\(2\\times 2\\) 분할표를 작성해보자. 참고로 원자료에서 생존시간이 \\(X=9\\) 로 관측된 경우는 중도절단이 된 관측값이므로 분할표를 작성을 하지 않는다. 네번째 분할표 처리/반응여부 사망 생존 합계 1 0 1 1 2 1 4 5 합계 1 5 6 네번째 분할표에서 귀무가설이 참인 경우, 즉 두 그룹의 생존시간에 대한 분포가 동일한 경우 \\(A\\) 에 대한 기대값은 다음과 같다. \\[ E_0(A) = \\frac{n_1 m_1}{n} = \\frac{(1)(1)}{6} = 0.17 \\] 또한 분산은 다음과 같다. \\[ Var_0 (A) = \\frac{n_1 n_2 m_1 m_2}{n^2(n-1)} = \\frac{(1)(5)}{5} \\frac{(1)(5)}{6^2} = 0.1388\\] 이런 식으로 중도절단이 되지 않은 생존시간이 발생했을 때 마다 위험집단에 있는 개체들에 대하여 \\(2\\times 2\\) 분할표를 작성하여 \\(a\\) 의 기대값과 분산을 계속 계산한다. 중도 절단이 되지 않은 7개의 생존시간에 대한 \\(2\\times 2\\) 분할표들에서 얻은 계산결과를 정리하면 다음표와 같다. 분할표들에서 얻은 계산결과 \\(X\\) \\(n\\) \\(m_1\\) \\(n_1\\) \\(a\\) \\(E_0(A)\\) \\(a-E_0(A)\\) \\(m_1 m_2/(n-1)\\) \\(n_1 n_2 /n^2\\) 3 10 1 5 1 0.50 0.50 1 0.2500 5 9 1 4 1 0.44 0.56 1 0.2469 7 8 1 3 1 0.38 0.62 1 0.2344 12 6 1 1 0 0.17 -0.17 1 0.1389 18 5 1 1 1 0.20 0.80 1 0.1600 19 4 1 0 0 0 0 1 0 20 3 1 0 0 0 0 1 0 이제 위의 표를 이용하여 다음과 같이 CMH 통계량을 계산할 수 있다. \\[\\begin{equation} CMH ~~\\chi^2 = \\frac {[ \\sum (a-E_0(A))]^2}{ \\sum [m_1 m_2/(n-1)][n_1 n_2 /n^2] } \\tag{3.1} \\end{equation}\\] 여기서 \\[\\begin{align*} \\sum (a-E_0(A)) &amp; = 0.50 + 0.56 + 0.62 -0.17 + 0.80 \\\\ &amp; = 2.31 \\\\ \\sum [m_1 m_2/(n-1)][n_1 n_2 /n^2] &amp; = (1)(0.2500) + (1)(0.2469) + (1)(0.2344) \\\\ &amp;+ (1)(0.1389) + (1)(0.1600) + (1)(0) + (1)(0) \\\\ &amp; = 1.0302 \\end{align*}\\] 따라서 \\[ CMH ~~\\chi^2 = \\frac{(2.31)^2} {1.0302} = 5.1796 \\] 유의수준 \\(\\alpha=0.05\\)에서 \\(\\chi^2(1,0.95) = 3.84159 &lt;5.1796\\)이므로 \\(H_0\\)를 기각한다. 즉 두 집단의 생존함수는 같지 않다. t &lt;- c(3, 5, 7, 9, 12, 18, 19, 20, 20, 33) delta &lt;- c(1,1,1,0,1,1,1,1,0,0) treat &lt;- c(&quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;B&quot;, &quot;A&quot;, &quot;B&quot;, &quot;B&quot;, &quot;B&quot;, &quot;B&quot;) df &lt;- data.frame(t, delta, treat) res.comp &lt;- survdiff(Surv(t, delta) ~ treat, data=df) 3.2 일반화 로그 순위 검정 식 (3.1) 에 주어진 로그-순위 건정법은 다음과 같이 각 시점마다 다른 가중치 \\(w_i\\)를 적용하여 일반화 할 수 있다. \\[\\begin{equation} CMH ~~\\chi^2 = \\frac {[ \\sum w_i (a-E_0(A))]^2}{ \\sum w_i^2 [m_1 m_2/(n-1)][n_1 n_2 /n^2] } \\tag{3.2} \\end{equation}\\] 아래 표는 식 (3.2) 에 주어진 일반화 로그-순위 검정에서 가준치의 형태와 해당하는 추정량의 이름이 나타나 있다. 가중치 \\(w_i\\)의 형태 추정량 이름 참고 1 Log rank \\(n_i\\) Wilcoxon \\(n_i\\) 는 위험집단의 수 \\(\\sqrt{n_i}\\) Tarone–Ware \\(\\tilde S(t_i)\\) Peto \\(\\tilde S(t_i)\\)는 그룹을 합쳐서 구한 생존함수 추량 \\(\\hat S (t_{i-1})^p [1 − \\hat S(t_{i-1})]^q\\) Flemington–Harrington \\(p\\) 와 \\(q\\)는 0 또는 1 3.3 예제 3.3.1 예제 7.3 교과서 이, 박, and 유 (2005) 의 예제 7-3은 흑생종 환자들에 대한 연구로 BCG 와 CP 면영ㄱ법의 생존시간 연장 효과를 비교하기 위한 실험이다. 환자들 중 11명은 BCG 처리를 받고 나머지 19명은 CP 처리를 받았다. 두 그룹의 생존시간에 대한 분포가 다른지 로그-순위 검정을 적용해보자. 먼저 자료는 example73.txt 에 저장되어 있다. df73 &lt;- read.csv(&quot;example73.txt&quot;, header = T, sep=&quot;&quot;) df73$treat &lt;- factor(df73$treat, level=c(1,2), labels = c(&quot;BCG&quot;, &quot;CP&quot;)) df73 ## time censor treat ## 1 33.7 0 BCG ## 2 3.9 1 BCG ## 3 10.5 1 BCG ## 4 5.4 1 BCG ## 5 19.5 1 BCG ## 6 23.8 0 BCG ## 7 7.9 1 BCG ## 8 16.9 0 BCG ## 9 16.6 0 BCG ## 10 33.7 0 BCG ## 11 17.1 0 BCG ## 12 8.0 1 CP ## 13 26.9 0 CP ## 14 21.4 0 CP ## 15 18.1 0 CP ## 16 16.0 0 CP ## 17 6.9 1 CP ## 18 11.0 0 CP ## 19 24.8 0 CP ## 20 23.0 0 CP ## 21 8.3 1 CP ## 22 10.8 0 CP ## 23 12.2 0 CP ## 24 12.5 0 CP ## 25 24.4 1 CP ## 26 7.7 1 CP ## 27 14.8 0 CP ## 28 8.2 0 CP ## 29 8.2 0 CP ## 30 7.8 0 CP 로그-순위검정은 함수 survdiff() 를 이용하여 다음과 같이 수행할 수 있다. exam73res &lt;- survdiff(Surv(time, censor) ~ treat, data=df73) exam73res ## Call: ## survdiff(formula = Surv(time, censor) ~ treat, data = df73) ## ## N Observed Expected (O-E)^2/E (O-E)^2/V ## treat=BCG 11 5 3.68 0.469 0.747 ## treat=CP 19 5 6.32 0.274 0.747 ## ## Chisq= 0.7 on 1 degrees of freedom, p= 0.4 exam73comp &lt;- survfit(Surv(time, censor) ~ treat, data=df73) plot(exam73comp, xlab=&quot;Time in months&quot;, ylab=&quot;Survival probability&quot;, col=c(&quot;blue&quot;, &quot;red&quot;), lwd=2) legend(&quot;topright&quot;, legend=c(&quot;BCG&quot;, &quot;CP&quot;), col=c(&quot;blue&quot;,&quot;red&quot;), lwd=2) "],["prohazrd.html", "제 4 장 비례위험모형 4.1 비례위험모형의 개요 4.2 부분 가능도 함수 4.3 예제 7.5", " 제 4 장 비례위험모형 4.1 비례위험모형의 개요 설명변수 또는 공변량 \\(x\\) 의 값에 따라서 반응변수 \\(y\\)의 평균이 어떻게 다른지 나타내는 모형을 회귀모형(regression model) 이라고 한다. 예를 들어 일반화 선형모형(generalized linear model)은 반응변수의 평균 \\(E(y|x)\\)과 선형예측식 \\(\\eta =\\beta_0+\\beta_1 x\\) 의 관계를 다음과 같이 연결함수 \\(g\\) 를 사용하여 모형을 만든다. \\[\\begin{equation} g[E(y|x)]= \\eta = \\beta_0+\\beta_1 x \\tag{4.1} \\end{equation}\\] 생존시간을 다루는 생존분석에서도 공변량이 생존시간 \\(T\\) 에 영향을 미치는 모형을 위와 같은 일반화 선형모형으로 고려하는 경우도 있다. 하지만 생존분석의 회귀모형에서는 생존시간의 평균보다 위험함수를 더 중요한 요소로 보기 때문에 공변량과 위험함수의 관계에 설정하는 회귀모형을 더 많이 사용한다. 생존분석에서 회귀모형을 고려하는 경우 주의할 점은 위험함수 \\(h(t)\\) 는 하나의 모수가 아닌 시간 \\(t\\)의 함수라는 것이다. 일반화 선형모형 (4.1) 에서는 공변량의 값이 0인 경우 (예를 들어 제어집단인 경우) 관측값은 평균이 \\(\\beta_0\\) 가 된다. 생존분석에는 공변량의 값에 따라서 위험함수가 변하게 되며 공변량의 값이 0인 경우 나타나는 기저 위험함수(baseline hazard function)은 평균과 같이 하나의 값이 아닌 시간의 함수로 주어진다는 것을 유의하자. 이제 공변량 \\(x\\)과 위험함수 \\(h(t)\\)의 관계를 다음과 같은 비례위험 모형으로 표현할 수 있다. \\[\\begin{equation} h(t) = h_0(t) \\gamma(x) \\tag{4.2} \\end{equation}\\] 위의 식 (4.2) 를 비례위험모형(proportional hazard model) 이라고 부르며 \\(h_0(t)\\) 는 기저 위험함수라고 부른다. 즉 \\(\\gamma(x)=1\\) 인 경우의 위험함수이다. 일반적으로 함수 \\(g(x)\\)를 선택하는 경우 공변량 \\(x=0\\) 이면 함수의 값이 1이 되도록 설정한다 (\\(\\gamma(0)=1\\)) 식 (4.2) 을 비례위험모형이라고 부르는 공변량이 위험함수에 미치는 영향이 가법적인 아닌 비례적으로 나타나며 시간에 따라 변하지 않는다는 의미이다. 예를 들어 두 개의 서로 다음 공변량 \\(x_1\\) 과 \\(x_2\\) 를 고려하면 모형 (4.2) 에 의하야 두 위험함수의 비는 다음과 같이 나타난다. \\[\\begin{equation} \\frac{ h(t|x_2)}{h(t|x_1)} = \\frac{ h_0(t) \\gamma(x_1) }{h_0(t) \\gamma(x_2)} = \\frac{ \\gamma(x_1) }{\\gamma(x_2)} \\tag{4.3} \\end{equation}\\] 위의 모형 (4.2) 에서 유의할 점은 시간에 따라서 공변량의 영향이 모두 동일하다는 것이다. 만약애 공변량의 영향이 시간에 따라서 변하면 함수 \\(\\gamma(x)\\)도 시간에 따라서 변화하는 함수 \\(\\gamma(x,t)\\)를 고려해야 한다. 시간에 따라서 공변량의 형태나 영향이 바뀌는 것을 시간의존 공변량(time-varying covariate) 라고 한다. 식 (4.2) 에 나타난 함수 \\(\\gamma(x)\\) 를 다음과 같이 회귀 계수 \\(\\beta\\) 포함된 지수함수의 형태롤 나타낸 모형을 Cox 의 비례위험모형이라고 부른다. \\[\\begin{equation} h(t) = h_0(t) \\exp (\\beta x) \\tag{4.4} \\end{equation}\\] 유의할 점은 Cox 의 모형에서는 일반적인 회귀모형에서 사용하는 절편을 포함시키지 않는다는 것이다. 즉, 일반적인 회귀모형에서 사용하는 절편이 Cox 모형에서는 기저 위험함수 \\(h_0(t)\\) 가 된다. Cox 비례위험모형에서는 위험함수의 비가 다음과 같이 나타난다. 아래에서 볼 수 있듯이 Cox 비례위험모형에서는 공변량이 1 단위 증가하면 위험함수가 \\(\\exp(\\beta)\\) 에 비례하게 증가한다. \\[\\begin{equation} \\frac{ h(t|x_2)}{h(t|x_1)} = \\frac{\\exp(\\beta x_2)}{\\exp(\\beta(x_1)} =\\exp[\\beta (x_2-x_1)] \\tag{4.5} \\end{equation}\\] 만약 공변량이 하나가 아니라 \\(p\\) 개를 가지는 경우 다음과 같이 모형을 확장할 수 있다. \\[ h(t) = h_0(t) \\exp (\\beta_1 x_1 + \\beta_2 x_2 + \\cdots + \\beta_p x_p) \\] Cox 비례위험모형 (4.2) 에서 양변에 로그를 하면 다음과 같은 모형이 된다. \\[ \\log h(t) = \\alpha(t) + \\beta x \\] 위의 모형에서 \\(\\alpha(t) =\\alpha_0\\) 이면 지수분포를 가정한 모형이 되고 \\(\\alpha(t) = \\alpha_0 + \\alpha_1 \\log(t)\\) 이면 와이블(weibull) 분포를 가정한 모형이 된다. 또한 생존시간과 위험함수의 관계 \\(S(t) = \\exp(-H(t))\\)를 이용하면 Cox 비례위험모형에서는 다음과 같이 나타낼 수 있다. \\[ S(t) = S_0(t)^{\\exp(\\beta x)} \\] 위의 식에서 \\(S_0(t)\\) 는 기저 위험함수 \\(h_0(t)\\) 를 가지는 생존함수이다. 4.2 부분 가능도 함수 Cox 비례위험모형은 특정한 분포를 가정하지 않고 공변량과 위험함수의 관계 만을 설정하고 있다. 또한 기저 위험함수의 특정한 형태도 가정하지 않는다. 따라서 Cox 비례위험모형의 가정 하에서는 완전한 가능도 함수를 구할 수 없다. 이러한 경우 부분 가능도함수(partial likelihood function)를 이용하면 특정한 분포의 가정없이 중도절단이 포함된 생존자료에서 회귀계수를 추정할 수 있다. 이제 독립적으로 관측된 \\(n\\) 개의 생존 시간 \\(t_i\\) 와 중도절단을 나타내는 함수 \\(\\delta_i\\), 그리고 공변량 \\(x_i\\)가 주어졌다고 하자. \\[ (t_1, \\delta_1, x_1), (t_2, \\delta_2, x_2), \\cdots , (t_n, \\delta_n, x_n) \\] 또한 위험함수는 Cox 비례위험모형 (4.4) 을 따른다고 가정하자. 즉 \\(i\\) 번째 관측값에 대한 위험함수 \\(h_i(t)\\)를 다음과 같이 나타낼 수 있다. \\[\\begin{equation} h_i(t) = h_0 (t) \\exp(\\beta x_i) \\tag{4.6} \\end{equation}\\] 만약 실제 생존 시간이 관측된 경우 \\((\\delta_i=1)\\) 관측값 \\(t_i\\) 의 가능도 함수 \\(L_i(\\beta)\\) 는 다음과 같다. \\[\\begin{equation} L_i(\\beta) = P(T=t_i) = f(t_i) = h_i(t_i) S_i(t_i) \\tag{4.7} \\end{equation}\\] 위의 식에서 마지막 결과는 위험함수의 정의 \\(h(t) = f(t)/S(t)\\)를 이용한 것이다. 만약 중도절단이 일어난 경우 \\((\\delta_i=0)\\) 관측값 \\(t_i\\) 의 가능도 함수 \\(L_i(\\beta)\\) 는 다음과 같다. \\[\\begin{equation} L_i(\\beta) = P(T &gt; t_i) = S_i(t_i) \\tag{4.8} \\end{equation}\\] 이제 \\(R(t)\\) 를 시간 \\(t\\) 에서의 위험집단(risk set), 즉 시간 \\(t\\) 까지 살아있는 개체들의 집합이라고 하자. \\[\\begin{equation} R(t) = \\sum_{i=1}^n I(t_i \\ge t) \\tag{4.9} \\end{equation}\\] 식 (4.7) 과 (4.8)를 합쳐서 모든 자료에 대한 가능도 함수 \\(L(\\beta)\\) 를 다음과 같이 나타낼 수 있다. \\[\\begin{align} L(\\beta) &amp; = \\prod_{i=1}^n L_i(\\beta) \\\\ \\notag &amp; = \\prod_{i=1}^n h_i (t)^{\\delta_i} S_i (t_i) \\\\ \\notag &amp; = \\prod_{i=1}^n \\left [ \\frac{h_i (t_i)} { \\sum_{j \\in R(t_i)} h_j (t_i)} \\right ]^{\\delta_i} \\left [ \\sum_{j \\in R(t_i)} h_j (t_i) \\right ]^{\\delta_i} S(t_i) \\\\ \\notag &amp; = \\prod_{i=1}^n \\left [ \\frac{h_i (t_i)} { \\sum_{j \\in R(t_i)} h_j (t_i)} \\right ]^{\\delta_i} \\prod_{i=1}^n \\left [ \\sum_{j \\in R(t_i)} h_j (t_i) \\right ]^{\\delta_i} S(t_i) \\tag{4.10} \\end{align}\\] 이제 가능도 함수 \\(L(\\beta)\\) (4.10) 의 첫 번째 부분을 먼저 자세히 살펴보자. 아래에서는 \\[\\begin{align} \\prod_{i=1}^n \\left [ \\frac{h_i (t_i)} { \\sum_{j \\in R(t_i)} h_j (t_i)} \\right ]^{\\delta_i} &amp; = \\prod_{i=1}^n \\left [ \\frac{h_0(t_i) \\exp(\\beta x_i)} { \\sum_{j \\in R(t_i)} h_0(t_i) \\exp(\\beta x_j)} \\right ]^{\\delta_i} \\\\ \\notag &amp; = \\prod_{i=1}^n \\left [ \\frac{\\exp(\\beta x_i)} { \\sum_{j \\in R(t_i)} \\exp(\\beta x_j)} \\right ]^{\\delta_i} \\tag{4.11} \\end{align}\\] 가능도 함수 \\(L(\\beta)\\)의 앞 부분은 위의 식 (4.11) 에서 나타났듯이 기저 위험함수 \\(h_0(t)\\) 가 나타나지 않고 공변량과 회귀계수 \\(\\beta\\) 만의 함수로 구성되어 있다. 또한 중도절단이 일어난 관측값(\\(\\delta_i=0\\))은 식 (4.11) 의 계산에서 제외된다. 식 (4.11) 에 주어진 함수를 부분 가능도함수라고 부른다. 가능도 함수 \\(L(\\beta)\\) (4.10) 의 두 번째 부분은 기저 위험함수 \\(h_0(t)\\) 가 포함된 부분으로서 부분 가능도함수를 이용하여 회귀계수를 추정하는 경우는 이 부분을 제외하고 추정하는 것이다. 4.3 예제 7.5 교과서 이, 박, and 유 (2005) 의 예제 7.5은 HSV_2 를 가진 48명의 환자들이 gD2(antigen glycoprotein)을 기초로 하는 새로운 백신연구의 연구 결과 자료이다. 생존시간은 처음 재발할 때 까지의 시간(time) 리고 연구 참여 전 발생한 에피소드의 횟수(x)를 공변량으로 하여 Cox 비례위험모형을 적합해 보자. 처리 그룹(treat)은 gD2 오 치료받은 그룹과 위약으로 치료반은 제어군이다. 자료는 example75.txt에 저장되어 있다. df75 &lt;- read.csv(&quot;example75.txt&quot;, header = T, sep=&quot;&quot;) df75$treat &lt;- factor(df75$treat) df75 ## treat x time censor ## 1 gd2 12 8 1 ## 2 gd2 6 44 1 ## 3 gd2 11 35 1 ## 4 gd2 9 52 0 ## 5 gd2 10 9 1 ## 6 gd2 13 13 1 ## 7 gd2 9 28 1 ## 8 pbo 7 8 1 ## 9 pbo 11 19 1 ## 10 pbo 15 4 1 ## 11 pbo 8 12 1 ## 12 pbo 14 5 1 ## 13 gd2 10 12 0 ## 14 gd2 8 14 1 ## 15 gd2 13 6 1 ## 16 gd2 12 52 0 ## 17 gd2 16 11 0 ## 18 gd2 13 21 1 ## 19 pbo 9 15 1 ## 20 pbo 7 12 1 ## 21 pbo 16 6 1 ## 22 pbo 9 9 0 ## 23 pbo 8 20 1 ## 24 pbo 13 35 1 ## 25 gd2 7 52 0 ## 26 gd2 8 3 1 ## 27 gd2 7 12 1 ## 28 gd2 13 36 1 ## 29 gd2 6 52 0 ## 30 gd2 16 24 0 ## 31 pbo 10 44 0 ## 32 pbo 7 52 0 ## 33 pbo 16 10 1 ## 34 pbo 10 27 1 ## 35 pbo 8 32 0 ## 36 pbo 9 28 1 ## 37 gd2 10 28 1 ## 38 gd2 9 52 0 ## 39 gd2 13 7 0 ## 40 gd2 8 52 0 ## 41 gd2 14 15 1 ## 42 gd2 13 52 0 ## 43 pbo 12 2 0 ## 44 pbo 7 21 1 ## 45 pbo 6 15 0 ## 46 pbo 17 1 1 ## 47 pbo 8 15 1 ## 48 pbo 15 6 1 함수 coxph() 는 Cox 비례위험모형을 적함하는 함수이다. 먼저 공변량을 포함하지 않고 처리효과의 차이 만을 고려한 Cox 비례위험모형을 적합해보자. ex75logrank &lt;- coxph(Surv(time, censor) ~ treat , data= df75) summary(ex75logrank) ## Call: ## coxph(formula = Surv(time, censor) ~ treat, data = df75) ## ## n= 48, number of events= 31 ## ## coef exp(coef) se(coef) z Pr(&gt;|z|) ## treatpbo 0.714 2.042 0.368 1.94 0.052 . ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## exp(coef) exp(-coef) lower .95 upper .95 ## treatpbo 2.04 0.49 0.993 4.2 ## ## Concordance= 0.595 (se = 0.048 ) ## Likelihood ratio test= 3.78 on 1 df, p=0.05 ## Wald test = 3.77 on 1 df, p=0.05 ## Score (logrank) test = 3.91 on 1 df, p=0.05 다음으로 공변량을 포함하는 Cox 비례위험모형을 적합해보자. ex75cox &lt;- coxph(Surv(time, censor) ~ treat + x, data= df75) summary(ex75cox) ## Call: ## coxph(formula = Surv(time, censor) ~ treat + x, data = df75) ## ## n= 48, number of events= 31 ## ## coef exp(coef) se(coef) z Pr(&gt;|z|) ## treatpbo 0.9016 2.4635 0.3748 2.41 0.0161 * ## x 0.1758 1.1922 0.0656 2.68 0.0074 ** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## exp(coef) exp(-coef) lower .95 upper .95 ## treatpbo 2.46 0.406 1.18 5.13 ## x 1.19 0.839 1.05 1.36 ## ## Concordance= 0.645 (se = 0.063 ) ## Likelihood ratio test= 10.8 on 2 df, p=0.004 ## Wald test = 10.7 on 2 df, p=0.005 ## Score (logrank) test = 11 on 2 df, p=0.004 "],["contingency.html", "부록 A: 분할표 검정 A.1 \\(2 \\times 2\\) 분할표에서 두 비율의 비교 A.2 코크란-맨텔-핸젤 검정", " 부록 A: 분할표 검정 A.1 \\(2 \\times 2\\) 분할표에서 두 비율의 비교 다음과 같은 \\(2 \\times 2\\) 분할표에서 두 비율을 비교한다고 가정하자. 처리/반응여부 반응 반응 안함 합계 1 \\(a\\) \\(b\\) \\(n_1\\) 2 \\(c\\) \\(d\\) \\(n_2\\) 합계 \\(m_1\\) \\(m_2\\) \\(n\\) 처리 1과 2가 서로 독립인 집단에 적용되었다면 두 집단의 반응 비율이 같다는 가설 \\(H_0: p_1=p_2\\)를 다음과 같은 통계량으로 검정할 수 있다. \\[ z = \\frac{ \\hat p_1 - \\hat p_2} { \\sqrt{\\hat p (1-\\hat p) (1/n_1 + 1/n_2)}} \\] 위에서 \\[ \\hat p_1 = \\frac{a}{n_1} \\quad \\hat p_2 = \\frac{c}{n_2} \\quad \\hat p = \\frac{m_1}{n} \\] \\(n\\)이 충분히 크면 귀무가설 하에서 통계량 \\(z\\)는 정규분포를 따르므로 \\(|z|&gt;z_{\\alpha/2}\\)이면 귀무가설을 기각한다. 카이제곱 분포의 정의에 의하여 통계량 \\(z\\)의 제곱 \\(\\chi^2 = z^2\\)은 자유도가 1인 카이제곱분포를 따른다. 이때 통계량 \\(z\\)의 제곱은 \\(2 \\times 2\\) 분할표에서 동일성 검정에 대한 카이제곱 통계량(교과서 46 페이지)과 동일하다. \\[ \\chi^2 = z^2 = \\frac {n(ad-bc)^2}{n_1 n_2 m_1 m_2} \\] 만약에 귀무가설이 참이고 주변합 \\(n_1, n_2, m_1, m_2\\)가 고정되어 있다고 가정하면 첫번째 행, 첫번째 열의 값 \\(A=a\\)의 분포는 다음과 같은 초기하분포(Hypergeometric distribution)를 따른다. \\[ P(A=a) = \\frac{ \\binom{n_1}{a} \\binom{n_2}{m_1-a} } {\\binom{n}{m_1}} \\] 위의 초기하분포에서 \\(A=a\\)의 기대값과 분산은 다음과 같다. \\[ E_0(A) = \\frac{n_1 m_2}{n}, \\quad Var_0 (A) = \\frac{n_1 n_2 m_1 m_2}{n^2(n-1)} \\] 따라서 다음이 성립하며 \\[ ad-bc = n[a-E_0(A)], \\quad n_1 n_2 m_1 m_2 = n^2(n-1) Var_0 (A) \\] 이제 \\(2 \\times 2\\) 분할표에서 동일성 검정에 대한 카이제곱 통계량은 초기하분포와 다음과 같은 관계를 가진다. \\[ \\chi^2 = z^2 = \\frac {n(ad-bc)^2}{n_1 n_2 m_1 m_2} = \\frac{n}{n-1} \\left [ \\frac{a-E_0(A)}{\\sqrt{var_0(A)}} \\right ]^2 \\] A.2 코크란-맨텔-핸젤 검정 교과서 53-55 페이지 참조 전체 자료가 다음과 같이 \\(K\\) 개의 \\(2 \\times 2\\) 분할표로 나누어 진다면 처리/반응여부 반응 반응 안함 합계 1 \\(n_{k11}\\) \\(n_{k12}\\) \\(n_{k1+}\\) 2 \\(n_{k21}\\) \\(n_{k22}\\) \\(n_{k2+}\\) 합계 \\(n_{k+1}\\) \\(n_{k+2}\\) \\(n_{k}\\) 전체 자료에 대하여 처리의 반응률에 대한 다음과 같은 가설검정을 \\[ H_0: p_{k1} = p_{k2}, ~~k=1,2,\\dots,K \\quad \\text{vs.} \\quad H_0: not~~ H_0 \\] 다음과 같은 코크란-맨텔-핸젤 검정 통계량(CMH 검정 통계량)으로 검정할 수 있다. \\[ Q_{CMH} = \\frac { [ \\sum_{k=1}^K (n_{k11} - E(n_{k11}|H_0) ) ]^2} { \\sum_{k=1}^K Var(n_{k11}|H_0)} \\] 위의 통계량에서 각 \\(2 \\times 2\\) 분할표에 대한 기대값과 분산은 다음과 같이 계산할 수 있다. \\[ E(n_{k11}|H_0) = \\frac{n_{k1+} n_{k+1}}{n_k} \\quad Var(n_{k11}|H_0) = \\frac{n_{k1+}n_{k2+} n_{k+1}n_{k+2}}{n^2_k(n_k-1)} \\] CMH 검정 통계량 \\(Q_{CMH}\\)은 귀무가설 \\(H_0\\)가 옳은 경우에 자유도 1을 가지는 카이제곱 분포를 따른다. "],["countingprocess.html", "부록 B: 계수과정과 생존분석 B.1 Nelson-Aalen 추정량", " 부록 B: 계수과정과 생존분석 B.1 Nelson-Aalen 추정량 이제 위험함수를 추정하는 Nelson-Aalen 추정량을 확률 과정으로 유도해보자. 먼저 생존시간 \\(T_i\\)에 대한 계수과정(counting process) \\(Y_i(t)\\) 을 정의해 보자. \\(Y_i(t)\\) 는 사건이 일어나기 전 까지 1인 함수이며 시간 \\(t\\) 까지 \\(i\\) 번째 개체가 위험 그룹(at risk at \\(t\\))에 속한는 지를 나타내는 확률과정이다. \\[ Y_i(t) = I(T_i \\ge t)\\] 또 하나의 계수과정 \\(N_i(t)\\)를 아래와 같이 정의한다. \\(N_i(t)\\) 는 절단이 없는 자 개체에 대하여 시간 \\(t\\) 까지 사건이 일어났는지를 알려주는 과정이다. \\[ N_i(t) = I(T_i \\le t, \\delta_i=1) \\] \\(Y_i(t)\\) 와 \\(N_i(t)\\)는 다음과 같은 모양을 가진 시간에 대한 함수이다. par(mfrow=c(2,2)) plot(stepfun(3, c(1,0)), xlab=&quot;t&quot;, ylab=&quot;Y(t)&quot;, do.points = TRUE,pch = 1, cex=2, col.points = &quot;black&quot;,verticals = FALSE, ylim=c(-0.5,1.5), main=&quot;Y(t) for uncersored subject&quot;) points(3,1, pch = 16, cex=2 ) plot(stepfun(3, c(1,0)), xlab=&quot;t&quot;, ylab=&quot;Y(t)&quot;, do.points = TRUE,pch = 1, cex=2, col.points = &quot;black&quot;,verticals = FALSE, ylim=c(-0.5,1.5), main=&quot;Y(t) for cersored subject&quot;) points(3,1, pch = 16, cex=2 ) plot(stepfun(3, c(0,1)), xlab=&quot;t&quot;, ylab=&quot;N(t)&quot;, do.points = TRUE,pch = 16, cex=2, col.points = &quot;black&quot;,verticals = FALSE, ylim=c(-0.5,1.5), main=&quot;N(t) for uncersored subject&quot;) points(3,0, pch = 1, cex=2 ) plot(stepfun(3, c(0,0)), xlab=&quot;t&quot;, ylab=&quot;N(t)&quot;, do.points = TRUE,pch =1, cex=2, col.points = &quot;black&quot;,verticals = FALSE, ylim=c(-0.5,1.5), main=&quot;N(t) for cersored subject&quot;) \\(Y_i(t)\\)는 왼쪽 연속함수(left continuity)의 형태를 가진다. 오른쪽 연속인 확률과정을 예측가능한 과정(predictable process) 라고 한다. \\(N_i(t)\\)는 오른쪽 연속함수(right continuity)의 형태를 가진다. 이제 두 확률 과정의 합을 정의하자. \\[ \\bar Y(t) =\\sum_{t_i \\le t} Y_i(t) \\quad \\text{ number at risk at } t\\] \\[ \\bar N(t) =\\sum_{t_i \\le t} N_i(t) \\quad \\text{ number of failures up to} t\\] 이제 누적 위험함수는 매우 짧은 시간 \\(h\\) 에 대하녀 다음과 같은 근사식이 성립한다. \\[ H(s+h) - H(s) \\approx h(s) h \\] 위의 식에서 \\(h(s)h\\) 는 시간 \\([s, s+h]\\) 동안에 일어난 사건의 발생률이라고 볼 수 있다. 따라서 \\(h(s)h\\) 는 시간 \\([s, s+h]\\) 동안에 일어난 사건의 발생한 사건의 수 \\(\\bar N(s+h) -\\bar N(s)\\)를 시간 \\(s\\) 에 위험해 처한 개채의 수 \\(\\bar Y(s)\\) 로 나는 값으로 추정할 수 있다. 이러한 사실을 이용하면 다음과 같은 추정식을 얻는다. \\[ \\hat H(t) = \\int_0^t \\frac{d \\bar N(s)} {\\bar Y(s)} \\] 위에서 구한 추정량 \\(\\hat H(t)\\) 는 각 사건이 일어날 경우만 점프가 생기므로 다음과 같이 쓸수 있다. \\[ \\hat H(t) =\\sum_{t_i \\le t} \\frac{\\Delta \\bar N(t_i)}{\\bar Y(ti)} = \\sum_{t_i \\le t} \\frac{d_i}{n_i}\\] plot(res.fh, cumhaz=TRUE) "],["references.html", "References", " References "]]
